import{i as O}from"./index-CbxrJH59.js";import{m as X,r as b,f as F,O as D,h as q,o as l,a as n,e,j as S,w as V,v as R,F as T,k as z,z as E,S as A,T as G,t as B,x as re,U as ue,V as J,c as de,l as K,u as j,L as ie,q as W,n as ce}from"./index-DOsYr_HV.js";import{u as pe}from"./useList-DwneSvMq.js";import{I as ve}from"./index-5TpuzGyx.js";const xe=()=>O.get("/api/db/tables"),be=_=>O.get(`/api/db/table/${_}`),me=(_,C)=>O.post("/api/db/modify-table-structure",{tableName:_,newStructure:C}),ge=_=>{const{tableName:C,...c}=_;return O.post(`/api/db/table/data/${C}`,{...c})},Q=(_,C)=>O.post(`/api/db/table/update/${_}`,{...C}),_e={class:"overflow-x-auto"},fe={class:"flex flex-row justify-end"},he={class:"table-wrapper",id:"table-wrapper"},ye={class:"w-full border border-gray-300 text-sm"},we={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},Ce=["onUpdate:modelValue","onChange"],$e={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},ke=["onUpdate:modelValue","onChange"],Ne=["value"],Me={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},Se=["onUpdate:modelValue","onChange"],Te={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},Ue=["onUpdate:modelValue","onChange"],Le={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},Ve={class:"hidden lg:block"},Ee=["onClick"],ze=["onClick"],Be=["onClick"],De={class:"lg:hidden"},qe={__name:"TableStruct",props:{tableName:{type:String,default:""},loading:{type:Boolean,default:!1}},emits:["update:tableName","update:loading"],setup(_,{emit:C}){const c=_,N=C,x=b(null),i=b(null),u=["INTEGER","REAL","TEXT","BLOB","NULL","VARCHAR","CHAR","BOOLEAN","DATE","DATETIME"],h=async t=>{if(t){x.value=t,N("update:loading",!0);const a=await be(t);i.value=a.data.data.map(m=>({...m,_key:Date.now()+Math.random()})),N("update:loading",!1)}},y=t=>{const a={name:"",type:u[0],notnull:0,dflt_value:"",_key:Date.now()+Math.random()};i.value.splice(t,0,a)},f=t=>{const a={name:"",type:u[0],notnull:0,dflt_value:"",_key:Date.now()+Math.random()};i.value.splice(t+1,0,a)},$=t=>{i.value.splice(t,1)},M=async()=>{console.log("修改后的表结构:",i.value),N("update:loading",!0),await me(x.value,i.value),await h(x.value),NvaMessage.success("保存成功"),N("update:loading",!1)},w=t=>{t._key=Date.now()+Math.random()},p=()=>{const t=document.querySelector("#table-container"),a=document.querySelector("#table-wrapper");console.log("xxxxxxxxxxxxxxxx",t.clientHeight),a.style.height=t.clientHeight+"px"},o=b(null);return F(()=>{new MutationObserver(a=>{console.log("监听tableContainer内容变化"),p()}).observe(o.value,{childList:!0,subtree:!0,characterData:!0})}),D(()=>c.tableName,t=>{h(t)},{immediate:!0}),(t,a)=>{const m=q("NvaButton"),k=q("a-button");return l(),n("div",_e,[e("div",fe,[S(m,{onClick:M,class:"mb-2"},{default:V(()=>a[0]||(a[0]=[R("SAVE")])),_:1})]),e("div",he,[e("div",{id:"table-container",class:"table-container",ref_key:"tableContainer",ref:o},[e("table",ye,[a[3]||(a[3]=e("thead",null,[e("tr",{class:"bg-gray-100"},[e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 字段名"),e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 类型"),e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 是否可空"),e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 默认值"),e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 操作")])],-1)),e("tbody",null,[(l(!0),n(T,null,z(i.value,(g,L)=>(l(),n("tr",{key:g._key,class:"hover:bg-gray-50"},[e("td",we,[E(e("input",{"onUpdate:modelValue":d=>g.name=d,class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:d=>w(g)},null,40,Ce),[[A,g.name,void 0,{lazy:!0}]])]),e("td",$e,[E(e("select",{"onUpdate:modelValue":d=>g.type=d,class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:d=>w(g)},[(l(),n(T,null,z(u,d=>e("option",{key:d,value:d},B(d),9,Ne)),64))],40,ke),[[G,g.type]])]),e("td",Me,[E(e("select",{"onUpdate:modelValue":d=>g.notnull=d,class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:d=>w(g)},a[1]||(a[1]=[e("option",{value:1},"是",-1),e("option",{value:0},"否",-1)]),40,Se),[[G,g.notnull]])]),e("td",Te,[E(e("input",{"onUpdate:modelValue":d=>g.dflt_value=d,placeholder:"NULL",class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:d=>w(g)},null,40,Ue),[[A,g.dflt_value,void 0,{lazy:!0}]])]),e("td",Le,[e("div",Ve,[e("button",{onClick:d=>y(L),class:"text-blue-600 hover:text-blue-800 mr-1 text-xs"},"前增",8,Ee),e("button",{onClick:d=>f(L),class:"text-blue-600 hover:text-blue-800 mr-1 text-xs"},"后增",8,ze),e("button",{onClick:d=>$(L),class:"text-red-600 hover:text-red-800 text-xs"},"删除",8,Be)]),e("div",De,[S(k,{size:"mini",type:"text"},{default:V(()=>a[2]||(a[2]=[R("操作")])),_:1})])])]))),128))])])],512)])])}}},Re=X(qe,[["__scopeId","data-v-5cd91611"]]),Ae={class:"table-wrapper",id:"table-wrapper"},Ie={class:"w-full border-collapse"},Pe=["onMousedown"],He=["onDblclick"],je={key:0},Oe=["onUpdate:modelValue","onBlur","onKeyup"],Xe={__name:"Datas",props:{columns:{type:Array,required:!0,default:()=>[]},list:{type:Array,required:!0,default:()=>[]}},emits:["update:list"],setup(_,{emit:C}){const c=_,N=C,x=b(null),i=b(null),u=b([]),h=b(null),y=(p,o)=>x.value===p&&i.value===o,f=(p,o)=>{x.value=p,i.value=o},$=(p,o)=>{const t=c.list[p],a=u.value.findIndex(m=>m.id===t.id);a!==-1?u.value[a]={...u.value[a],[o]:t[o]}:u.value.push({id:t.id,[o]:t[o]}),console.log(u.value),N("update:list",u.value),x.value=null,i.value=null},M=(p,o)=>{const t=p.target.closest("th"),a=p.pageX,m=t.offsetWidth,k=L=>{console.log(t);const d=m+L.pageX-a;t.style.width=`${d}px`},g=()=>{document.removeEventListener("mousemove",k),document.removeEventListener("mouseup",g)};document.addEventListener("mousemove",k),document.addEventListener("mouseup",g)},w=()=>{const p=document.querySelector("#table-container"),o=document.querySelector("#table-wrapper");console.log("xxxxxxxxxxxxxxxx",p.clientHeight),o.style.height=p.clientHeight+"px"};return D(c.list,()=>{re(()=>{w()})}),F(()=>{new MutationObserver(o=>{console.log("监听tableContainer内容变化"),w()}).observe(h.value,{childList:!0,subtree:!0,characterData:!0})}),ue(()=>{}),(p,o)=>(l(),n("div",Ae,[e("div",{id:"table-container",class:"table-container",ref_key:"tableContainer",ref:h},[e("table",Ie,[e("thead",null,[e("tr",null,[(l(!0),n(T,null,z(_.columns,t=>(l(),n("th",{key:t,class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"},[R(B(t)+" ",1),e("div",{class:"resize-handle",onMousedown:a=>M(a)},null,40,Pe)]))),128))])]),e("tbody",null,[(l(!0),n(T,null,z(_.list,(t,a)=>(l(),n("tr",{key:a},[(l(!0),n(T,null,z(_.columns,m=>(l(),n("td",{key:`${a}-${m}`,class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate",onDblclick:k=>f(a,m)},[y(a,m)?E((l(),n("input",{key:1,"onUpdate:modelValue":k=>t[m]=k,onBlur:k=>$(a,m),onKeyup:J(k=>$(a,m),["enter"]),class:"w-full px-1 py-0.5 text-xs border-none focus:outline-none focus:ring-1 focus:ring-blue-500",ref_for:!0,ref:k=>{k&&k.focus()}},null,40,Oe)),[[A,t[m]]]):(l(),n("span",je,B(t[m]),1))],40,He))),128))]))),128))])])],512)]))}},We=X(Xe,[["__scopeId","data-v-3b33073a"]]),Ge={class:"w-full"},Ke={class:"mb-4"},Fe=["default-value"],Qe={class:"mt-2 flex justify-end"},Je={class:"flex flex-row justify-between mb-2"},Ye={class:"inline-block flex-1 min-w-full align-middle table-view"},Ze={class:"min-w-full border border-gray-300 text-sm"},et={class:"bg-gray-100"},tt=["onMousedown"],at=["onUpdate:modelValue","onChange"],st={class:"border px-1 py-1 text-center"},lt=["onClick"],ot=["onClick","disabled"],nt={class:"flex justify-between items-center mt-4"},rt={class:"text-sm"},ut={class:"flex items-center"},dt=["disabled"],it=["max"],ct={class:"mx-2 text-sm"},pt=["disabled"],vt={__name:"TableDatas",props:{tableName:{type:String,required:!0},loading:{type:Boolean,default:!1}},emits:["update:loading"],setup(_,{emit:C}){const c=_,N=C,x=b([]),i=b(!1),u=b(1),h=b(20),y=b(""),f=b([]),{list:$,loading:M,refresh:w,total:p,result:o}=pe(ge,{tableName:c.tableName});D(o,s=>{y.value=s.sql});const t=de(()=>Math.ceil(p.value/h.value)),a=b(1),m=()=>{u.value>1&&L(u.value-1)},k=()=>{u.value<t.value&&L(u.value+1)},g=()=>{const s=Math.min(Math.max(1,a.value),t.value);L(s)},L=s=>{u.value=s,a.value=s,w({page:s,pageSize:h.value,tableName:c.tableName})},d=()=>{u.value=1,w({page:1,pageSize:h.value,tableName:c.tableName})},Y=s=>{s._changed=!0,i.value=!0},Z=s=>{$.value.splice(s,1),i.value=!0},ee=async s=>{M.value=!0;try{await Q(c.tableName,{data:[s]}),s._changed=!1,i.value=$.value.some(r=>r._changed),NvaMessage.success("保存成功")}catch(r){console.error("Error saving row:",r),NvaMessage.error("保存失败")}finally{M.value=!1}},te=(s,r)=>{const I=s.target.closest("th"),v=s.pageX,P=I.offsetWidth,U=oe=>{const ne=P+oe.pageX-v;I.style.width=`${ne}px`},H=()=>{document.removeEventListener("mousemove",U),document.removeEventListener("mouseup",H)};document.addEventListener("mousemove",U),document.addEventListener("mouseup",H)},ae=async()=>{M.value=!0;try{console.log($.value),await Q(c.tableName,{data:f.value}),w(),f.value=[],i.value=!1,NvaMessage.success("保存成功")}catch(s){console.error("Error saving changes:",s),NvaMessage.error("保存失败")}finally{M.value=!1}},se=s=>{f.value=s,console.log("newList",s)},le=async()=>{console.log("sqlStr",y.value),await w({page:1,pageSize:h.value,tableName:c.tableName,sql:y.value}),NvaMessage.success("查询成功")};return D(()=>c.tableName,s=>{console.log("newTableName",{tableName:s,page:1,pageSize:h.value}),w({tableName:s,page:1,pageSize:h.value})}),D($,s=>{s.length>0&&(x.value=Object.keys(s[0]).filter(r=>r!=="_id"),console.log("columns",x.value))},{immediate:!0}),D(()=>u.value,s=>{a.value=s}),D(M,s=>{N("update:loading",s)}),(s,r)=>{const I=q("NvaButton");return l(),n("div",Ge,[e("div",Ke,[E(e("textarea",{"onUpdate:modelValue":r[0]||(r[0]=v=>y.value=v),"default-value":y.value,placeholder:"输入 SQL 查询...",class:"w-full h-24 p-2 border border-gray-300 rounded-md text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,8,Fe),[[A,y.value]]),e("div",Qe,[S(I,{onClick:le},{default:V(()=>r[3]||(r[3]=[R("运行")])),_:1})])]),e("div",Je,[e("div",null,[r[5]||(r[5]=e("span",{class:"mr-2"},"每页显示:",-1)),E(e("select",{"onUpdate:modelValue":r[1]||(r[1]=v=>h.value=v),onChange:d,class:"border border-gray-300 px-2 py-1 text-sm"},r[4]||(r[4]=[e("option",{value:10},"10",-1),e("option",{value:20},"20",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),544),[[G,h.value]])]),S(I,{onClick:ae,disabled:!f.value.length},{default:V(()=>r[6]||(r[6]=[R("保存更改")])),_:1},8,["disabled"])]),K("",!0),S(We,{columns:x.value,list:j($),"onUpdate:list":se},{default:V(()=>[e("div",Ye,[e("table",Ze,[e("thead",null,[e("tr",et,[(l(!0),n(T,null,z(x.value,v=>(l(),n("th",{key:v,class:"border border-gray-300 text-xs px-2 py-1"},[R(B(v)+" ",1),e("div",{class:"resize-handle",onMousedown:P=>te(P,v)},null,40,tt)]))),128)),r[7]||(r[7]=e("th",{class:"border border-gray-300 text-xs px-2 py-1"},"操作",-1))])]),e("tbody",null,[(l(!0),n(T,null,z(j($),(v,P)=>(l(),n("tr",{key:v._id,class:"hover:bg-gray-50"},[(l(!0),n(T,null,z(x.value,U=>(l(),n("td",{key:`${v._id}-${U}`,class:"border border-gray-300 px-1 py-1"},[U==="_id"?(l(),n(T,{key:0},[R(B(v[U]),1)],64)):E((l(),n("input",{key:1,"onUpdate:modelValue":H=>v[U]=H,class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:H=>Y(v)},null,40,at)),[[A,v[U]]])]))),128)),e("td",st,[e("button",{onClick:U=>Z(P),class:"text-red-600 hover:text-red-800 text-xs mr-2"},"删除",8,lt),e("button",{onClick:U=>ee(v),class:"text-blue-600 hover:text-blue-800 text-xs",disabled:!v._changed},"保存",8,ot)])]))),128))])])])]),_:1},8,["columns","list"]),e("div",nt,[e("span",rt,"总记录数: "+B(j(p)),1),e("div",ut,[e("button",{onClick:m,disabled:u.value===1,class:"px-2 py-1 mr-2 text-sm border rounded bg-white text-blue-500 disabled:opacity-50"}," 上一页 ",8,dt),E(e("input",{"onUpdate:modelValue":r[2]||(r[2]=v=>a.value=v),onKeyup:J(g,["enter"]),class:"w-16 px-2 py-1 text-sm border rounded text-center",type:"number",min:"1",max:t.value},null,40,it),[[A,a.value,void 0,{number:!0}]]),e("span",ct,"/ "+B(t.value),1),e("button",{onClick:k,disabled:u.value===t.value,class:"px-2 py-1 ml-2 text-sm border rounded bg-white text-blue-500 disabled:opacity-50"}," 下一页 ",8,pt)])])])}}},xt=X(vt,[["__scopeId","data-v-409a1463"]]),bt={class:"flex flex-col lg:flex-row box-wrapper"},mt=["onClick"],gt={class:"flex-grow truncate"},_t={class:"flex flex-row items-center hover:bg-gray-100 p-2 rounded-md cursor-pointer active:bg-gray-200"},ft={__name:"Console",setup(_){const C=b([]),c=b(null),N=b(!0),x=b(!1),i=b(0),u=async()=>{N.value=!0;const y=await xe();C.value=y.data.data,N.value=!1},h=async y=>{c.value=y};return F(()=>{u()}),(y,f)=>{const $=q("a-spin"),M=q("BoxView"),w=q("NavTab"),p=q("a-empty");return l(),n("div",bt,[S(M,{class:"w-full lg:w-1/5 lg:mr-4"},{default:V(()=>[S($,{loading:N.value,class:"w-full h-full"},{default:V(()=>[(l(!0),n(T,null,z(C.value,(o,t)=>(l(),n("div",{onClick:a=>h(o.name),class:ce(["flex flex-row items-center hover:bg-gray-100 p-2 rounded-md cursor-pointer active:bg-gray-200",c.value==o.name&&"bg-gray-200"]),key:t},[S(j(ve),{size:"24",class:"mr-2 flex-shrink-0"}),e("span",gt,B(o.name),1)],10,mt))),128)),e("div",_t,[S(j(ie),{size:"24",class:"mr-2 flex-shrink-0"}),f[3]||(f[3]=e("span",{class:"flex-grow truncate"},"新建表",-1))])]),_:1},8,["loading"])]),_:1}),S(M,{class:"boxRight"},{default:V(()=>[S($,{loading:x.value,class:"w-full h-full"},{default:V(()=>[c.value?(l(),n(T,{key:0},[S(w,{tabs:["表结构","数据"],tabIndex:i.value,"onUpdate:tabIndex":f[0]||(f[0]=o=>i.value=o)},null,8,["tabIndex"]),i.value==0?(l(),W(Re,{key:0,tableName:c.value,loading:x.value,"onUpdate:loading":f[1]||(f[1]=o=>x.value=o)},null,8,["tableName","loading"])):K("",!0),i.value==1?(l(),W(xt,{key:1,tableName:c.value,loading:x.value,"onUpdate:loading":f[2]||(f[2]=o=>x.value=o)},null,8,["tableName","loading"])):K("",!0)],64)):(l(),W(p,{key:1,class:"w-full h-full flex items-center justify-center"}))]),_:1},8,["loading"])]),_:1})])}}},$t=X(ft,[["__scopeId","data-v-6f6f0a18"]]);export{$t as default};
