import{i as D}from"./index-CZWiWUhx.js";import{m as I,r as v,f as O,O as U,h as T,o as r,a as g,e,j as C,w as S,v as B,F as V,k as M,z as L,S as z,T as H,t as q,x as W,U as X,q as E,V as K,u as A,L as F,l as P,n as Q}from"./index-BYuF_VRx.js";import{u as J}from"./useList-DZ0eOvd9.js";import{I as Y}from"./index-Be9rzcPF.js";const Z=()=>D.get("/api/db/tables"),ee=b=>D.get(`/api/db/table/${b}`),te=(b,_)=>D.post("/api/db/modify-table-structure",{tableName:b,newStructure:_}),ae=b=>{const{tableName:_,...d}=b;return D.post(`/api/db/table/data/${_}`,{...d})},le=(b,_)=>D.post(`/api/db/table/update/${b}`,{..._}),oe={class:"overflow-x-auto"},se={class:"flex flex-row justify-end"},ne={class:"table-wrapper",id:"table-wrapper"},re={class:"w-full border border-gray-300 text-sm"},ue={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},de=["onUpdate:modelValue","onChange"],ie={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},ce=["onUpdate:modelValue","onChange"],pe=["value"],ve={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},be=["onUpdate:modelValue","onChange"],xe={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},ge=["onUpdate:modelValue","onChange"],me={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},fe={class:"hidden lg:block"},_e=["onClick"],ye=["onClick"],he=["onClick"],we={class:"lg:hidden"},Ce={__name:"TableStruct",props:{tableName:{type:String,default:""},loading:{type:Boolean,default:!1}},emits:["update:tableName","update:loading"],setup(b,{emit:_}){const d=b,k=_,x=v(null),i=v(null),u=["INTEGER","REAL","TEXT","BLOB","NULL","VARCHAR","CHAR","BOOLEAN","DATE","DATETIME"],y=async a=>{if(a){x.value=a,k("update:loading",!0);const l=await ee(a);i.value=l.data.data.map(p=>({...p,_key:Date.now()+Math.random()})),k("update:loading",!1)}},w=a=>{const l={name:"",type:u[0],notnull:0,dflt_value:"",_key:Date.now()+Math.random()};i.value.splice(a,0,l)},m=a=>{const l={name:"",type:u[0],notnull:0,dflt_value:"",_key:Date.now()+Math.random()};i.value.splice(a+1,0,l)},N=a=>{i.value.splice(a,1)},$=async()=>{console.log("修改后的表结构:",i.value),k("update:loading",!0),await te(x.value,i.value),await y(x.value),NvaMessage.success("保存成功"),k("update:loading",!1)},h=a=>{a._key=Date.now()+Math.random()},c=()=>{const a=document.querySelector("#table-container"),l=document.querySelector("#table-wrapper");console.log("xxxxxxxxxxxxxxxx",a.clientHeight),l.style.height=a.clientHeight+"px"},o=v(null);return O(()=>{new MutationObserver(l=>{console.log("监听tableContainer内容变化"),c()}).observe(o.value,{childList:!0,subtree:!0,characterData:!0})}),U(()=>d.tableName,a=>{y(a)},{immediate:!0}),(a,l)=>{const p=T("NvaButton"),f=T("a-button");return r(),g("div",oe,[e("div",se,[C(p,{onClick:$,class:"mb-2"},{default:S(()=>l[0]||(l[0]=[B("SAVE")])),_:1})]),e("div",ne,[e("div",{id:"table-container",class:"table-container",ref_key:"tableContainer",ref:o},[e("table",re,[l[3]||(l[3]=e("thead",null,[e("tr",{class:"bg-gray-100"},[e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 字段名"),e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 类型"),e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 是否可空"),e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 默认值"),e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 操作")])],-1)),e("tbody",null,[(r(!0),g(V,null,M(i.value,(s,n)=>(r(),g("tr",{key:s._key,class:"hover:bg-gray-50"},[e("td",ue,[L(e("input",{"onUpdate:modelValue":t=>s.name=t,class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:t=>h(s)},null,40,de),[[z,s.name,void 0,{lazy:!0}]])]),e("td",ie,[L(e("select",{"onUpdate:modelValue":t=>s.type=t,class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:t=>h(s)},[(r(),g(V,null,M(u,t=>e("option",{key:t,value:t},q(t),9,pe)),64))],40,ce),[[H,s.type]])]),e("td",ve,[L(e("select",{"onUpdate:modelValue":t=>s.notnull=t,class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:t=>h(s)},l[1]||(l[1]=[e("option",{value:1},"是",-1),e("option",{value:0},"否",-1)]),40,be),[[H,s.notnull]])]),e("td",xe,[L(e("input",{"onUpdate:modelValue":t=>s.dflt_value=t,placeholder:"NULL",class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:t=>h(s)},null,40,ge),[[z,s.dflt_value,void 0,{lazy:!0}]])]),e("td",me,[e("div",fe,[e("button",{onClick:t=>w(n),class:"text-blue-600 hover:text-blue-800 mr-1 text-xs"},"前增",8,_e),e("button",{onClick:t=>m(n),class:"text-blue-600 hover:text-blue-800 mr-1 text-xs"},"后增",8,ye),e("button",{onClick:t=>N(n),class:"text-red-600 hover:text-red-800 text-xs"},"删除",8,he)]),e("div",we,[C(f,{size:"mini",type:"text"},{default:S(()=>l[2]||(l[2]=[B("操作")])),_:1})])])]))),128))])])],512)])])}}},ke=I(Ce,[["__scopeId","data-v-5cd91611"]]),Ne={class:"table-wrapper",id:"table-wrapper"},$e={class:"w-full border-collapse"},Te=["onMousedown"],Se=["onDblclick"],Ue=["onUpdate:modelValue","onBlur","onKeyup"],Le={__name:"Datas",props:{columns:{type:Array,required:!0,default:()=>[]},list:{type:Array,required:!0,default:()=>[]}},emits:["update:list"],setup(b,{emit:_}){const d=b,k=_,x=v(null),i=v(null),u=v([]),y=v(null),w=(c,o)=>x.value===c&&i.value===o,m=(c,o)=>{x.value=c,i.value=o},N=(c,o)=>{const a=d.list[c],l=u.value.findIndex(p=>p.id===a.id);l!==-1?u.value[l]={...u.value[l],[o]:a[o]}:u.value.push({id:a.id,[o]:a[o]}),console.log(u.value),k("update:list",u.value),x.value=null,i.value=null},$=(c,o)=>{const a=c.target.closest("th"),l=c.pageX,p=a.offsetWidth,f=n=>{console.log(a);const t=p+n.pageX-l;a.style.width=`${t}px`},s=()=>{document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",s)};document.addEventListener("mousemove",f),document.addEventListener("mouseup",s)},h=()=>{const c=document.querySelector("#table-container"),o=document.querySelector("#table-wrapper");o.style.height=c.clientHeight+"px"};return U(d.list,()=>{W(()=>{h()})}),O(()=>{new MutationObserver(o=>{h()}).observe(y.value,{childList:!0,subtree:!0,characterData:!0})}),X(()=>{}),(c,o)=>{const a=T("NvaTextScroll");return r(),g("div",Ne,[e("div",{id:"table-container",class:"table-container",ref_key:"tableContainer",ref:y},[e("table",$e,[e("thead",null,[e("tr",null,[(r(!0),g(V,null,M(b.columns,l=>(r(),g("th",{key:l,class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"},[B(q(l)+" ",1),e("div",{class:"resize-handle",onMousedown:p=>$(p)},null,40,Te)]))),128))])]),e("tbody",null,[(r(!0),g(V,null,M(b.list,(l,p)=>(r(),g("tr",{key:p},[(r(!0),g(V,null,M(b.columns,f=>(r(),g("td",{key:`${p}-${f}`,class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate",onDblclick:s=>m(p,f)},[w(p,f)?L((r(),g("input",{key:1,"onUpdate:modelValue":s=>l[f]=s,onBlur:s=>N(p,f),onKeyup:K(s=>N(p,f),["enter"]),class:"w-full px-1 py-0.5 text-xs border-none focus:outline-none focus:ring-1 focus:ring-blue-500",ref_for:!0,ref:s=>{s&&s.focus()}},null,40,Ue)),[[z,l[f]]]):(r(),E(a,{key:0,start:"hover"},{default:S(()=>[B(q(l[f]),1)]),_:2},1024))],40,Se))),128))]))),128))])])],512)])}}},Ve=I(Le,[["__scopeId","data-v-3727b63c"]]),Me={class:"w-full"},Be={class:"mb-4"},De=["default-value"],Ee={class:"mt-2 flex justify-end"},ze={class:"flex flex-row justify-between mb-2"},qe={__name:"TableDatas",props:{tableName:{type:String,required:!0},loading:{type:Boolean,default:!1}},emits:["update:loading"],setup(b,{emit:_}){const d=b,k=_,x=v([]),i=v(!1),u=v(20),y=v(""),w=v([]),m=J(ae,{tableName:d.tableName}),{list:N,loading:$,refresh:h,result:c,page:o}=m;U(c,n=>{y.value=n.sql});const a=v(1),l=()=>{h({page:1,pageSize:u.value,tableName:d.tableName})},p=async()=>{$.value=!0;try{console.log(N.value),await le(d.tableName,{data:w.value}),h(),w.value=[],i.value=!1,NvaMessage.success("保存成功")}catch(n){console.error("Error saving changes:",n),NvaMessage.error("保存失败")}finally{$.value=!1}},f=n=>{w.value=n,console.log("newList",n)},s=async()=>{console.log("sqlStr",y.value),await h({page:1,pageSize:u.value,tableName:d.tableName,sql:y.value}),NvaMessage.success("查询成功")};return U(()=>d.tableName,n=>{console.log("newTableName",{tableName:n,page:1,pageSize:u.value}),h({tableName:n,page:1,pageSize:u.value})}),U(N,n=>{n.length>0&&(x.value=Object.keys(n[0]).filter(t=>t!=="_id"),console.log("columns",x.value))},{immediate:!0}),U(()=>o,n=>{a.value=n}),U($,n=>{k("update:loading",n)}),(n,t)=>{const j=T("NvaButton"),G=T("NvaPagination");return r(),g("div",Me,[e("div",Be,[L(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=R=>y.value=R),"default-value":y.value,placeholder:"输入 SQL 查询...",class:"w-full h-24 p-2 border border-gray-300 rounded-md text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,8,De),[[z,y.value]]),e("div",Ee,[C(j,{onClick:s},{default:S(()=>t[2]||(t[2]=[B("运行")])),_:1})])]),e("div",ze,[e("div",null,[t[4]||(t[4]=e("span",{class:"mr-2"},"每页显示:",-1)),L(e("select",{"onUpdate:modelValue":t[1]||(t[1]=R=>u.value=R),onChange:l,class:"border border-gray-300 px-2 py-1 text-sm"},t[3]||(t[3]=[e("option",{value:10},"10",-1),e("option",{value:20},"20",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),544),[[H,u.value]])]),C(j,{onClick:p,disabled:!w.value.length},{default:S(()=>t[5]||(t[5]=[B("保存更改")])),_:1},8,["disabled"])]),C(Ve,{columns:x.value,list:A(N),"onUpdate:list":f},null,8,["columns","list"]),C(G,{hook:A(m)},null,8,["hook"])])}}},Ae=I(qe,[["__scopeId","data-v-c04f2bd2"]]),Ie={class:"flex flex-col lg:flex-row box-wrapper"},Re=["onClick"],He={class:"flex-grow truncate"},Oe={class:"flex flex-row items-center hover:bg-gray-100 p-2 rounded-md cursor-pointer active:bg-gray-200"},je={__name:"Console",setup(b){const _=v([]),d=v(null),k=v(!0),x=v(!1),i=v(0),u=async()=>{k.value=!0;const w=await Z();_.value=w.data.data,k.value=!1},y=async w=>{d.value=w};return O(()=>{u()}),(w,m)=>{const N=T("a-spin"),$=T("BoxView"),h=T("NavTab"),c=T("a-empty");return r(),g("div",Ie,[C($,{class:"w-full lg:w-1/5 lg:mr-4"},{default:S(()=>[C(N,{loading:k.value,class:"w-full h-full"},{default:S(()=>[(r(!0),g(V,null,M(_.value,(o,a)=>(r(),g("div",{onClick:l=>y(o.name),class:Q(["flex flex-row items-center hover:bg-gray-100 p-2 rounded-md cursor-pointer active:bg-gray-200",d.value==o.name&&"bg-gray-200"]),key:a},[C(A(Y),{size:"24",class:"mr-2 flex-shrink-0"}),e("span",He,q(o.name),1)],10,Re))),128)),e("div",Oe,[C(A(F),{size:"24",class:"mr-2 flex-shrink-0"}),m[3]||(m[3]=e("span",{class:"flex-grow truncate"},"新建表",-1))])]),_:1},8,["loading"])]),_:1}),C($,{class:"boxRight"},{default:S(()=>[C(N,{loading:x.value,class:"w-full h-full"},{default:S(()=>[d.value?(r(),g(V,{key:0},[C(h,{tabs:["表结构","数据"],tabIndex:i.value,"onUpdate:tabIndex":m[0]||(m[0]=o=>i.value=o)},null,8,["tabIndex"]),i.value==0?(r(),E(ke,{key:0,tableName:d.value,loading:x.value,"onUpdate:loading":m[1]||(m[1]=o=>x.value=o)},null,8,["tableName","loading"])):P("",!0),i.value==1?(r(),E(Ae,{key:1,tableName:d.value,loading:x.value,"onUpdate:loading":m[2]||(m[2]=o=>x.value=o)},null,8,["tableName","loading"])):P("",!0)],64)):(r(),E(c,{key:1,class:"w-full h-full flex items-center justify-center"}))]),_:1},8,["loading"])]),_:1})])}}},Ke=I(je,[["__scopeId","data-v-6f6f0a18"]]);export{Ke as default};
