import{_ as te,d as q,g as le,c as j,i as se,o as u,a as d,n as G,b as Q,e as n,r as y,h as C,t as w,u as F,v as _,j as m,w as k,M as I,m as Ve,I as ce,B as Pe,C as Me,q as R,D as Be,F as U,k as Z,E as fe,f as me,l as z,G as Oe,p as de,H as Te,J as Re,x as Ze,K as T,s as qe}from"./index-M__yPbcM.js";import{O as Ge,d as ve,a as ge,b as Qe,g as We,c as Je,u as Ke,s as He}from"./config-VLqcDX4r.js";import{B as pe}from"./BoxView-LVuxVXVq.js";import{I as Xe}from"./index-B_5H_2vY.js";import"./index-BvZkX2qZ.js";const Ye=q({name:"IconCode",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:r}){const t=le("icon"),o=j(()=>[t,`${t}-code`,{[`${t}-spin`]:e.spin}]),p=j(()=>{const i={};return e.size&&(i.fontSize=se(e.size)?`${e.size}px`:e.size),e.rotate&&(i.transform=`rotate(${e.rotate}deg)`),i});return{cls:o,innerStyle:p,onClick:i=>{r("click",i)}}}}),et=["stroke-width","stroke-linecap","stroke-linejoin"],tt=n("path",{d:"M16.734 12.686 5.42 24l11.314 11.314m14.521-22.628L42.57 24 31.255 35.314M27.2 6.28l-6.251 35.453"},null,-1),lt=[tt];function st(e,r,t,o,p,a){return u(),d("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:G(e.cls),style:Q(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:r[0]||(r[0]=(...i)=>e.onClick&&e.onClick(...i))},lt,14,et)}var X=te(Ye,[["render",st]]);const nt=Object.assign(X,{install:(e,r)=>{var t;const o=(t=r==null?void 0:r.iconPrefix)!=null?t:"";e.component(o+X.name,X)}}),ot=q({name:"IconCommon",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:r}){const t=le("icon"),o=j(()=>[t,`${t}-common`,{[`${t}-spin`]:e.spin}]),p=j(()=>{const i={};return e.size&&(i.fontSize=se(e.size)?`${e.size}px`:e.size),e.rotate&&(i.transform=`rotate(${e.rotate}deg)`),i});return{cls:o,innerStyle:p,onClick:i=>{r("click",i)}}}}),at=["stroke-width","stroke-linecap","stroke-linejoin"],it=n("path",{d:"M24 23 7.652 14.345M24 23l16.366-8.664M24 23v19.438M7 14v20l17 9 17-9V14L24 5 7 14Z"},null,-1),rt=[it];function ut(e,r,t,o,p,a){return u(),d("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:G(e.cls),style:Q(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:r[0]||(r[0]=(...i)=>e.onClick&&e.onClick(...i))},rt,14,at)}var Y=te(ot,[["render",ut]]);const ct=Object.assign(Y,{install:(e,r)=>{var t;const o=(t=r==null?void 0:r.iconPrefix)!=null?t:"";e.component(o+Y.name,Y)}}),dt=q({name:"IconFolder",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:r}){const t=le("icon"),o=j(()=>[t,`${t}-folder`,{[`${t}-spin`]:e.spin}]),p=j(()=>{const i={};return e.size&&(i.fontSize=se(e.size)?`${e.size}px`:e.size),e.rotate&&(i.transform=`rotate(${e.rotate}deg)`),i});return{cls:o,innerStyle:p,onClick:i=>{r("click",i)}}}}),pt=["stroke-width","stroke-linecap","stroke-linejoin"],ft=n("path",{d:"M6 13h18l-2.527-3.557a1.077 1.077 0 0 0-.88-.443H7.06C6.474 9 6 9.448 6 10v3Zm0 0h33.882c1.17 0 2.118.895 2.118 2v21c0 1.105-.948 3-2.118 3H8.118C6.948 39 6 38.105 6 37V13Z"},null,-1),mt=[ft];function vt(e,r,t,o,p,a){return u(),d("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:G(e.cls),style:Q(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:r[0]||(r[0]=(...i)=>e.onClick&&e.onClick(...i))},mt,14,pt)}var ee=te(dt,[["render",vt]]);const gt=Object.assign(ee,{install:(e,r)=>{var t;const o=(t=r==null?void 0:r.iconPrefix)!=null?t:"";e.component(o+ee.name,ee)}}),yt={key:0,class:"space-y-4"},kt=["href"],ht={class:"text-blue-500 hover:text-blue-700 underline"},bt={key:1},wt={__name:"FileInfo",props:{file:{type:Object,required:!0}},emits:["fileDeleted","aliasUpdated"],setup(e,{emit:r}){const t=e,o=r,p=y(!1),a=y(t.file.alias||t.file.path),i=y(!1),x=async g=>{p.value=!0;try{if((await ve({fileIds:t.file.id+""})).data.success)I.success("删除成功"),o("fileDeleted",{success:!0,fileId:t.file.id}),g();else throw new Error("删除失败")}catch(c){I.error("删除失败："+c.message),o("fileDeleted",{success:!1,fileId:t.file.id,error:c.message}),g(!1)}finally{p.value=!1}},h=g=>{a.value=g},b=async()=>{i.value=!0;try{if((await ge({fileId:t.file.id,alias:a.value})).data.success)I.success("Alias saved successfully"),o("aliasUpdated",{fileId:t.file.id,newAlias:a.value});else throw new Error("Failed to save alias")}catch(g){I.error("Failed to save alias: "+g.message)}finally{i.value=!1}},v=g=>g<1024?g+" B":g<1024*1024?(g/1024).toFixed(2)+" KB":g<1024*1024*1024?(g/(1024*1024)).toFixed(2)+" MB":(g/(1024*1024*1024)).toFixed(2)+" GB",A=g=>new Date(g).toLocaleString();return(g,c)=>{const L=C("a-button"),W=C("a-input"),B=C("a-popconfirm");return u(),d("div",null,[c[11]||(c[11]=n("h2",{class:"text-xl font-bold mb-4"},"File Information",-1)),e.file?(u(),d("div",yt,[n("a",{href:`${F(Ge)}${e.file.full_path}`,target:"_blank",class:"block"},[c[1]||(c[1]=n("p",{class:"mb-1"},[n("strong",null,"Name:")],-1)),n("span",ht,w(e.file.file_name),1)],8,kt),n("p",null,[c[2]||(c[2]=n("strong",null,"Type:",-1)),_(" "+w(e.file.type===0?"Folder":"File"),1)]),n("p",null,[c[3]||(c[3]=n("strong",null,"Full Path:",-1)),_(" "+w(e.file.full_path),1)]),n("p",null,[c[4]||(c[4]=n("strong",null,"Size:",-1)),_(" "+w(v(e.file.file_size)),1)]),n("p",null,[c[5]||(c[5]=n("strong",null,"File Type:",-1)),_(" "+w(e.file.file_type),1)]),n("p",null,[c[6]||(c[6]=n("strong",null,"Created At:",-1)),_(" "+w(A(e.file.created_at)),1)]),n("p",null,[c[7]||(c[7]=n("strong",null,"Updated At:",-1)),_(" "+w(A(e.file.updated_at)),1)]),n("div",null,[c[9]||(c[9]=n("p",{class:"mb-1"},[n("strong",null,"Alias:")],-1)),m(W,{modelValue:a.value,"onUpdate:modelValue":c[0]||(c[0]=O=>a.value=O),placeholder:"Set an alias for this file","default-value":e.file.alias||e.file.path,onChange:h},{suffix:k(()=>[m(L,{type:"text",onClick:b,loading:i.value},{default:k(()=>c[8]||(c[8]=[_(" Save ")])),_:1},8,["loading"])]),_:1},8,["modelValue","default-value"])]),m(B,{content:"确认删除此文件吗？",type:"warning","ok-loading":p.value,onBeforeOk:x},{default:k(()=>[m(L,{type:"primary",class:"mt-6"},{default:k(()=>c[10]||(c[10]=[_("删除")])),_:1})]),_:1},8,["ok-loading"])])):(u(),d("div",bt," No file information available. "))])}}},xt=q({name:"IconFile",props:{fileName:{type:String,required:!0},type:{type:Number,default:0}},setup(e){const r=o=>o.split(".").pop().toLowerCase();return{iconComponent:j(()=>{if(e.type===0)return gt;switch(r(e.fileName)){case"pdf":case"doc":case"docx":case"txt":return ce;case"jpg":case"jpeg":case"png":case"gif":return Xe;case"mp4":case"avi":case"mov":return Me;case"mp3":case"wav":return Pe;case"zip":case"rar":return ct;case"js":case"vue":case"py":case"java":return nt;default:return ce}})}}});function Ct(e,r,t,o,p,a){return u(),R(Be(e.iconComponent))}const Ft=Ve(xt,[["render",Ct]]),_t={class:"absolute top-2 right-2 z-10"},At=["onClick"],It={class:"text-sm text-center truncate w-full block"},St={__name:"ViewModeFolder",props:{fileList:{type:Array,required:!0}},emits:["folderClick","triggerFileUpload","updateSelectedFiles"],setup(e,{emit:r}){const t=r,o=y([]),p=(x,h)=>{if(h)o.value.push(x);else{const b=o.value.indexOf(x);b>-1&&o.value.splice(b,1)}console.log("selectedFiles",o.value),t("updateSelectedFiles",o.value)},a=()=>{t("triggerFileUpload")},i=(x,h,b)=>{t("folderClick",x,h,b)};return(x,h)=>{const b=C("a-checkbox");return u(),d(U,null,[(u(!0),d(U,null,Z(e.fileList,v=>(u(),d("div",{key:v.id,class:"flex flex-col items-center p-2 border rounded cursor-pointer active:opacity-50 relative"},[n("div",_t,[m(b,{"model-value":o.value.includes(v.id),onChange:A=>p(v.id,A)},null,8,["model-value","onChange"])]),n("div",{onClick:A=>i(v.type,v.full_path,v),class:"w-full h-full flex flex-col items-center justify-center"},[m(Ft,{size:"24",type:v.type,fileName:v.path},null,8,["type","fileName"]),n("span",It,w(v.alias||v.path),1)],8,At)]))),128)),n("div",{class:"flex flex-col items-center p-2 border rounded cursor-pointer active:opacity-50",onClick:a},[m(F(fe),{size:"24",class:"mb-2"}),h[0]||(h[0]=n("span",{class:"text-sm text-center break-words"},"上传",-1))])],64)}}};function zt(e){return(e/1024/1024).toFixed(2)+"MB"}const Ut="/assets/icon_folder-Dn5kCvJT.png",jt="/assets/icon_audio-Ciu7_aS0.png",Dt="/assets/icon_video-CblCkkD0.png",$t="/assets/icon_pdf-C1I33Bud.png",Lt="/assets/icon_txt-BTPhg_V_.png",Nt="/assets/icon_zip-93NlvEmD.png",Et="data:image/png;base64,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",Vt={class:"w-24 h-24 flex items-center justify-center overflow-hidden"},Pt=["src"],Mt=["src"],Bt=["src"],Ot=["src"],Tt=["src"],Rt=["src"],Zt=["src"],qt=["src"],Gt={__name:"IconFilePreview",props:{file:{type:Object,required:!0}},setup(e){const r=e,t=y("txt"),o=a=>a.split(".").pop().toLowerCase(),p=a=>{switch(o(a)){case"pdf":case"doc":case"docx":case"txt":return"document";case"jpg":case"jpeg":case"png":case"gif":return"image";case"mp4":case"avi":case"mov":return"video";case"mp3":case"wav":return"audio";case"zip":case"rar":case"7z":case"tar":case"gz":case"bz2":case"xz":return"zip";case"js":case"vue":case"py":case"java":return"code";default:return"unknown"}};return me(()=>{t.value=p(r.file.path)}),(a,i)=>(u(),d("div",Vt,[e.file.type===0?(u(),d("img",{key:0,src:F(Ut),alt:"file preview",class:"w-full h-full object-cover p-2"},null,8,Pt)):(u(),d(U,{key:1},[t.value==="image"?(u(),d("img",{key:0,src:F(Qe)+e.file.full_path,alt:"file preview",class:"w-full object-cover p-2"},null,8,Mt)):z("",!0),t.value==="audio"?(u(),d("img",{key:1,src:F(jt),alt:"file preview",class:"w-full h-full object-cover p-2"},null,8,Bt)):z("",!0),t.value==="video"?(u(),d("img",{key:2,src:F(Dt),alt:"file preview",class:"w-full h-full object-cover p-2"},null,8,Ot)):z("",!0),t.value==="document"?(u(),d("img",{key:3,src:F($t),alt:"file preview",class:"w-full h-full object-cover p-2"},null,8,Tt)):z("",!0),t.value==="code"?(u(),d("img",{key:4,src:F(Lt),alt:"file preview",class:"w-full h-full object-cover p-2"},null,8,Rt)):z("",!0),t.value==="zip"?(u(),d("img",{key:5,src:F(Nt),alt:"file preview",class:"w-full h-full object-cover p-2"},null,8,Zt)):z("",!0),t.value==="unknown"?(u(),d("img",{key:6,src:F(Et),alt:"file preview",class:"w-full h-full object-cover p-2"},null,8,qt)):z("",!0)],64))]))}},Qt={class:"absolute top-2 right-2 z-10"},Wt=["onClick"],Jt={class:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white p-1 text-xs"},Kt={class:"truncate text-center"},Ht={key:0,class:"text-center"},Xt={__name:"ViewModePreview",props:{fileList:{type:Array,required:!0}},emits:["folderClick","triggerFileUpload","updateSelectedFiles"],setup(e,{emit:r}){const t=r,o=y([]),p=(x,h)=>{if(h)o.value.push(x);else{const b=o.value.indexOf(x);b>-1&&o.value.splice(b,1)}console.log("selectedFiles",o.value),t("updateSelectedFiles",o.value)},a=()=>{t("triggerFileUpload")},i=(x,h,b)=>{t("folderClick",x,h,b)};return(x,h)=>{const b=C("a-checkbox");return u(),d(U,null,[(u(!0),d(U,null,Z(e.fileList,v=>(u(),d("div",{key:v.id,class:"flex flex-col items-center p-2 border rounded cursor-pointer active:opacity-50 relative"},[n("div",Qt,[m(b,{"model-value":o.value.includes(v.id),onChange:A=>p(v.id,A)},null,8,["model-value","onChange"])]),n("div",{onClick:A=>i(v.type,v.full_path,v),class:"w-24 h-32 flex flex-col items-center justify-center"},[m(Gt,{file:v},null,8,["file"]),n("div",Jt,[n("div",Kt,w(v.alias||v.path),1),v.type===1?(u(),d("div",Ht,w(F(zt)(v.file_size)),1)):z("",!0)])],8,Wt)]))),128)),n("div",{class:"flex flex-col items-center justify-center p-2 border rounded cursor-pointer active:opacity-50",onClick:a},[m(F(fe),{size:"24",class:"mb-2"}),h[0]||(h[0]=n("span",{class:"text-sm text-center break-words"},"上传",-1))])],64)}}},Yt={class:"flex flex-row items-center justify-between mb-4 overflow-hidden"},el={class:"flex flex-row items-center hidden sm:flex"},tl={key:2,class:"absolute inset-0 bg-blue-500 bg-opacity-50 flex items-center justify-center"},ll={key:0,class:"text-center text-gray-500 py-4"},sl={class:"flex justify-between items-center mb-2"},nl={class:"text-sm font-medium text-gray-600"},ol={class:"text-xs text-gray-500"},al={class:"w-full bg-gray-200 h-2 rounded-full overflow-hidden"},il={class:"text-xs text-gray-500 mt-1 text-right"},rl={class:"text-sm text-gray-500 mb-4"},vl={__name:"FileList",setup(e){const r=qe(),t=Ze(),o=y([]),p=y(!1),a=y("/"),i=y(!1),x=y(!1),h=y(""),b=y(!1),v=y(null),A=y(!1),g=y(0),c=y(!1),L=y(null),W=j(()=>{const s=a.value.split("/").filter(Boolean);return s.map((l,S)=>({name:l,path:"/"+s.slice(0,S+1).join("/")}))}),B=s=>{r.push({query:{dir:encodeURIComponent(s)}})};me(()=>{const s=t.query.dir;s&&(a.value=decodeURIComponent(s)),D(a.value)}),Oe(()=>t.query.dir,s=>{s&&(a.value=decodeURIComponent(s),D(a.value))});const O=async(s,l,S)=>{s===0?await r.push({query:{dir:encodeURIComponent(l)}}):(L.value=S,i.value=!0)},D=async s=>{p.value=!0;try{const l=await We({dir:s});o.value=l.data.data,a.value=s}catch(l){I.error("获取文件列表失败："+l.message)}finally{p.value=!1}},ye=()=>{x.value=!0},ke=async()=>{if(!/^[a-zA-Z0-9_-]+$/.test(h.value)){I.warning("文件夹名称只能包含字母、数字、下划线和横杠");return}p.value=!0;const s=await Je({dir:a.value,folder:h.value});s.data.success?(I.success("新建文件夹成功"),await D(a.value)):I.error(s.data.message),p.value=!1},he=s=>{s.preventDefault(),g.value++,g.value===1&&(b.value=!0)},be=s=>{s.preventDefault(),g.value--,g.value===0&&(b.value=!1)},we=de({files:[]}),{files:E}=Te(we),xe=s=>{E.value.push(de({name:s.name,size:s.size,status:"Pending",progress:0,speed:"0 KB/s"}))},ne=(s,l,S)=>{s.progress=Math.round(l),s.speed=S+"MB/s",l===100?s.status="Completed":s.status="Uploading"},Ce=()=>{E.value=[]},oe=async s=>{A.value=!0;try{const l=Array.from(s);l.forEach(xe);for(const S of l){const P=E.value.find(N=>N.name===S.name);P.status="Uploading";const M=await Ke(S,({progress:N,speed:H})=>ne(P,N,H),a.value);M.url&&(await He({url:M.url,fileSize:M.fileSize,dir:a.value}),ne(P,100,0))}I.success("Files uploaded successfully"),await D(a.value),setTimeout(Ce,2e3)}catch(l){I.error("Error uploading files"),console.error("Upload error:",l)}finally{A.value=!1}},Fe=s=>{s.preventDefault(),b.value=!1,g.value=0,oe(s.dataTransfer.files)},_e=s=>{oe(s.target.files),s.target.value=""},ae=s=>{$.value=s},ie=()=>{v.value.click()},Ae=async({success:s,fileId:l})=>{s&&(i.value=!1,await D(a.value))},$=y([]),V=y(!1),Ie=()=>{V.value=!0},Se=async()=>{try{const s=$.value.join(",");p.value=!0,await ve({fileIds:s}),I.success(`成功删除 ${$.value.length} 个文件/文件夹`),$.value=[],await D(a.value)}catch(s){I.error("批量删除失败："+s.message)}finally{V.value=!1}},J=y(!1),K=y(""),ze=s=>{L.value=s,J.value=!0},Ue=async()=>{p.value=!0,await ge({path:a.value,alias:K.value}),p.value=!1},je=async({fileId:s,newAlias:l})=>{await D(a.value)};return(s,l)=>{const S=C("NvaButton"),P=C("a-space"),M=C("TitleLine"),N=C("a-breadcrumb-item"),H=C("a-breadcrumb"),De=C("a-switch"),$e=C("a-button"),Le=C("a-spin"),re=C("NvaInput"),ue=C("NvaModal"),Ne=C("a-modal");return u(),d(U,null,[m(M,{title:"File List"},{right:k(()=>[m(P,null,{default:k(()=>[m(S,{type:"primary",onClick:ye},{default:k(()=>l[10]||(l[10]=[_("新建文件夹")])),_:1}),m(S,{type:"primary",danger:"",disabled:$.value.length===0,onClick:Ie},{default:k(()=>[_(" 批量删除 ("+w($.value.length)+") ",1)]),_:1},8,["disabled"])]),_:1})]),_:1}),m(Le,{class:"w-full",loading:p.value||A.value},{default:k(()=>[m(pe,null,{default:k(()=>[n("div",Yt,[m(H,{class:"flex-1 min-w-0 max-w-[50%]"},{default:k(()=>[m(N,{onClick:l[0]||(l[0]=f=>B("/")),class:"truncate"},{default:k(()=>l[11]||(l[11]=[_("Root")])),_:1}),(u(!0),d(U,null,Z(W.value,(f,Ee)=>(u(),R(N,{key:Ee,onClick:ul=>B(f.path),class:"truncate"},{default:k(()=>[_(w(f.name),1)]),_:2},1032,["onClick"]))),128))]),_:1}),n("div",el,[m(De,{modelValue:c.value,"onUpdate:modelValue":l[1]||(l[1]=f=>c.value=f),type:"line",size:"mini",class:"mr-4 flex-shrink-0"},{"checked-icon":k(()=>l[12]||(l[12]=[])),"unchecked-icon":k(()=>l[13]||(l[13]=[])),_:1},8,["modelValue"]),m($e,{type:"primary",size:"mini",onClick:ze,class:"flex-shrink-0"},{default:k(()=>l[14]||(l[14]=[_("设置别名")])),_:1})])]),n("div",{class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 auto-rows-auto relative",onDragenter:T(he,["prevent"]),onDragover:l[2]||(l[2]=T(()=>{},["prevent"])),onDragleave:T(be,["prevent"]),onDrop:T(Fe,["prevent"])},[c.value?(u(),R(St,{key:0,"file-list":o.value,onFolderClick:O,onTriggerFileUpload:ie,onUpdateSelectedFiles:ae},null,8,["file-list"])):(u(),R(Xt,{key:1,"file-list":o.value,onFolderClick:O,onTriggerFileUpload:ie,onUpdateSelectedFiles:ae},null,8,["file-list"])),b.value?(u(),d("div",tl,l[15]||(l[15]=[n("p",{class:"text-white text-xl font-bold"},"Drop files here to upload",-1)]))):z("",!0)],32)]),_:1})]),_:1},8,["loading"]),m(pe,{class:"mt-6"},{default:k(()=>[l[16]||(l[16]=n("h3",{class:"text-lg font-semibold text-gray-700 mb-4"},"待上传文件列表",-1)),F(E).length===0?(u(),d("div",ll," 暂无待上传文件 ")):(u(!0),d(U,{key:1},Z(F(E),f=>(u(),d("div",{key:f.name,class:"mb-4"},[n("div",sl,[n("span",nl,w(f.name),1),n("span",{class:G(["text-xs font-semibold px-2 py-1 rounded-full",{"bg-blue-100 text-blue-800":f.status==="uploading","bg-green-100 text-green-800":f.status==="completed","bg-red-100 text-red-800":f.status==="error"}])},[_(w(f.status)+" ",1),n("span",ol,w(f.speed),1)],2)]),n("div",al,[n("div",{class:"bg-blue-500 h-full transition-all duration-300 ease-in-out",style:Q({width:`${f.progress}%`})},null,4)]),n("div",il,w(f.progress)+"% ",1)]))),128))]),_:1}),n("input",{type:"file",ref_key:"fileInput",ref:v,onChange:_e,style:{display:"none"},multiple:""},null,544),m(ue,{modelValue:x.value,"onUpdate:modelValue":l[4]||(l[4]=f=>x.value=f),title:"新建文件夹",onOk:ke},{default:k(()=>[n("div",rl,"当前目录："+w(a.value),1),m(re,{modelValue:h.value,"onUpdate:modelValue":l[3]||(l[3]=f=>h.value=f),placeholder:"请输入文件夹名称"},null,8,["modelValue"])]),_:1},8,["modelValue"]),m(ue,{modelValue:J.value,"onUpdate:modelValue":l[6]||(l[6]=f=>J.value=f),title:"设置别名",onOk:Ue},{default:k(()=>[m(re,{modelValue:K.value,"onUpdate:modelValue":l[5]||(l[5]=f=>K.value=f),placeholder:"请输入别名"},null,8,["modelValue"])]),_:1},8,["modelValue"]),m(Re,{visible:i.value,"onUpdate:visible":l[7]||(l[7]=f=>i.value=f)},{default:k(()=>[m(wt,{file:L.value,onFileDeleted:Ae,onAliasUpdated:je},null,8,["file"])]),_:1},8,["visible"]),m(Ne,{visible:V.value,"onUpdate:visible":l[8]||(l[8]=f=>V.value=f),title:"确认批量删除",onOk:Se,onCancel:l[9]||(l[9]=f=>V.value=!1)},{default:k(()=>[n("p",null,"确定要删除选中的 "+w($.value.length)+" 个文件/文件夹吗？此操作不可撤销。",1)]),_:1},8,["visible"])],64)}}};export{vl as default};
