import{i as D}from"./index-CDBvrqn-.js";import{m as A,r as c,f as O,O as U,h as T,o as u,a as f,e,j as y,w as S,v as B,F as V,k as L,z as M,S as z,T as H,t as q,x as W,U as X,q as E,V as K,u as I,L as F,l as P,n as Q}from"./index-AVI2xKDk.js";import{u as J}from"./useList-D_uSFXS9.js";import{I as Y}from"./index-9L3zReCr.js";const Z=()=>D.get("/api/db/tables"),ee=p=>D.get(`/api/db/table/${p}`),te=(p,_)=>D.post("/api/db/modify-table-structure",{tableName:p,newStructure:_}),ae=p=>{const{tableName:_,...b}=p;return D.post(`/api/db/table/data/${_}`,{...b})},le=(p,_)=>D.post(`/api/db/table/update/${p}`,{..._}),oe=p=>D.post("/api/db/create/table",{tableName:p}),se={class:"overflow-x-auto"},ne={class:"flex flex-row justify-end"},re={class:"table-wrapper",id:"table-wrapper"},ue={class:"w-full border border-gray-300 text-sm"},de={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},ie=["onUpdate:modelValue","onChange"],ce={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},pe=["onUpdate:modelValue","onChange"],ve=["value"],be={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},xe=["onUpdate:modelValue","onChange"],me={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},ge=["onUpdate:modelValue","onChange"],fe={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},ye={class:"hidden lg:block"},_e=["onClick"],he=["onClick"],we=["onClick"],Ce={class:"lg:hidden"},ke={__name:"TableStruct",props:{tableName:{type:String,default:""},loading:{type:Boolean,default:!1}},emits:["update:tableName","update:loading"],setup(p,{emit:_}){const b=p,h=_,m=c(null),x=c(null),d=["INTEGER","REAL","TEXT","BLOB","NULL","VARCHAR","CHAR","BOOLEAN","DATE","DATETIME"],w=async o=>{if(o){m.value=o,h("update:loading",!0);const l=await ee(o);x.value=l.data.data.map(i=>({...i,_key:Date.now()+Math.random()})),h("update:loading",!1)}},C=o=>{const l={name:"",type:d[0],notnull:0,dflt_value:"",_key:Date.now()+Math.random()};x.value.splice(o,0,l)},N=o=>{const l={name:"",type:d[0],notnull:0,dflt_value:"",_key:Date.now()+Math.random()};x.value.splice(o+1,0,l)},$=o=>{x.value.splice(o,1)},k=async()=>{console.log("修改后的表结构:",x.value),h("update:loading",!0),await te(m.value,x.value),await w(m.value),NvaMessage.success("保存成功"),h("update:loading",!1)},s=o=>{o._key=Date.now()+Math.random()},v=()=>{const o=document.querySelector("#table-container"),l=document.querySelector("#table-wrapper");console.log("xxxxxxxxxxxxxxxx",o.clientHeight),l.style.height=o.clientHeight+"px"},r=c(null);return O(()=>{new MutationObserver(l=>{console.log("监听tableContainer内容变化"),v()}).observe(r.value,{childList:!0,subtree:!0,characterData:!0})}),U(()=>b.tableName,o=>{w(o)},{immediate:!0}),(o,l)=>{const i=T("NvaButton"),g=T("a-button");return u(),f("div",se,[e("div",ne,[y(i,{onClick:k,class:"mb-2"},{default:S(()=>l[0]||(l[0]=[B("SAVE")])),_:1})]),e("div",re,[e("div",{id:"table-container",class:"table-container",ref_key:"tableContainer",ref:r},[e("table",ue,[l[3]||(l[3]=e("thead",null,[e("tr",{class:"bg-gray-100"},[e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 字段名"),e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 类型"),e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 是否可空"),e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 默认值"),e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 操作")])],-1)),e("tbody",null,[(u(!0),f(V,null,L(x.value,(t,n)=>(u(),f("tr",{key:t._key,class:"hover:bg-gray-50"},[e("td",de,[M(e("input",{"onUpdate:modelValue":a=>t.name=a,class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:a=>s(t)},null,40,ie),[[z,t.name,void 0,{lazy:!0}]])]),e("td",ce,[M(e("select",{"onUpdate:modelValue":a=>t.type=a,class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:a=>s(t)},[(u(),f(V,null,L(d,a=>e("option",{key:a,value:a},q(a),9,ve)),64))],40,pe),[[H,t.type]])]),e("td",be,[M(e("select",{"onUpdate:modelValue":a=>t.notnull=a,class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:a=>s(t)},l[1]||(l[1]=[e("option",{value:1},"是",-1),e("option",{value:0},"否",-1)]),40,xe),[[H,t.notnull]])]),e("td",me,[M(e("input",{"onUpdate:modelValue":a=>t.dflt_value=a,placeholder:"NULL",class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:a=>s(t)},null,40,ge),[[z,t.dflt_value,void 0,{lazy:!0}]])]),e("td",fe,[e("div",ye,[e("button",{onClick:a=>C(n),class:"text-blue-600 hover:text-blue-800 mr-1 text-xs"},"前增",8,_e),e("button",{onClick:a=>N(n),class:"text-blue-600 hover:text-blue-800 mr-1 text-xs"},"后增",8,he),e("button",{onClick:a=>$(n),class:"text-red-600 hover:text-red-800 text-xs"},"删除",8,we)]),e("div",Ce,[y(g,{size:"mini",type:"text"},{default:S(()=>l[2]||(l[2]=[B("操作")])),_:1})])])]))),128))])])],512)])])}}},Ne=A(ke,[["__scopeId","data-v-5cd91611"]]),Te={class:"table-wrapper",id:"table-wrapper"},$e={class:"w-full border-collapse"},Se=["onMousedown"],Ve=["onDblclick"],Ue=["onUpdate:modelValue","onBlur","onKeyup"],Me={__name:"Datas",props:{columns:{type:Array,required:!0,default:()=>[]},list:{type:Array,required:!0,default:()=>[]}},emits:["update:list"],setup(p,{emit:_}){const b=p,h=_,m=c(null),x=c(null),d=c([]),w=c(null),C=(v,r)=>m.value===v&&x.value===r,N=(v,r)=>{m.value=v,x.value=r},$=(v,r)=>{const o=b.list[v],l=d.value.findIndex(i=>i.id===o.id);l!==-1?d.value[l]={...d.value[l],[r]:o[r]}:d.value.push({id:o.id,[r]:o[r]}),console.log(d.value),h("update:list",d.value),m.value=null,x.value=null},k=(v,r)=>{const o=v.target.closest("th"),l=v.pageX,i=o.offsetWidth,g=n=>{console.log(o);const a=i+n.pageX-l;o.style.width=`${a}px`},t=()=>{document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",t)};document.addEventListener("mousemove",g),document.addEventListener("mouseup",t)},s=()=>{const v=document.querySelector("#table-container"),r=document.querySelector("#table-wrapper");r.style.height=v.clientHeight+"px"};return U(b.list,()=>{W(()=>{s()})}),O(()=>{new MutationObserver(r=>{s()}).observe(w.value,{childList:!0,subtree:!0,characterData:!0})}),X(()=>{}),(v,r)=>{const o=T("NvaTextScroll");return u(),f("div",Te,[e("div",{id:"table-container",class:"table-container",ref_key:"tableContainer",ref:w},[e("table",$e,[e("thead",null,[e("tr",null,[(u(!0),f(V,null,L(p.columns,l=>(u(),f("th",{key:l,class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"},[B(q(l)+" ",1),e("div",{class:"resize-handle",onMousedown:i=>k(i)},null,40,Se)]))),128))])]),e("tbody",null,[(u(!0),f(V,null,L(p.list,(l,i)=>(u(),f("tr",{key:i},[(u(!0),f(V,null,L(p.columns,g=>(u(),f("td",{key:`${i}-${g}`,class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate",onDblclick:t=>N(i,g)},[C(i,g)?M((u(),f("input",{key:1,"onUpdate:modelValue":t=>l[g]=t,onBlur:t=>$(i,g),onKeyup:K(t=>$(i,g),["enter"]),class:"w-full px-1 py-0.5 text-xs border-none focus:outline-none focus:ring-1 focus:ring-blue-500",ref_for:!0,ref:t=>{t&&t.focus()}},null,40,Ue)),[[z,l[g]]]):(u(),E(o,{key:`text_${l.id}`,start:"hover"},{default:S(()=>[B(q(l[g]),1)]),_:2},1024))],40,Ve))),128))]))),128))])])],512)])}}},Le=A(Me,[["__scopeId","data-v-871d2873"]]),Be={class:"w-full"},De={class:"mb-4"},Ee=["default-value"],ze={class:"mt-2 flex justify-end"},qe={class:"flex flex-row justify-between mb-2"},Ie={__name:"TableDatas",props:{tableName:{type:String,required:!0},loading:{type:Boolean,default:!1}},emits:["update:loading"],setup(p,{emit:_}){const b=p,h=_,m=c([]),x=c(!1),d=c(20),w=c(""),C=c([]),N=J(ae,{tableName:b.tableName}),{list:$,loading:k,refresh:s,result:v,page:r}=N;U(v,n=>{w.value=n.sql});const o=c(1),l=()=>{s({page:1,pageSize:d.value,tableName:b.tableName})},i=async()=>{k.value=!0;try{console.log($.value),await le(b.tableName,{data:C.value}),s(),C.value=[],x.value=!1,NvaMessage.success("保存成功")}catch(n){console.error("Error saving changes:",n),NvaMessage.error("保存失败")}finally{k.value=!1}},g=n=>{C.value=n,console.log("newList",n)},t=async()=>{console.log("sqlStr",w.value),await s({page:1,pageSize:d.value,tableName:b.tableName,sql:w.value}),NvaMessage.success("查询成功")};return U(()=>b.tableName,n=>{console.log("newTableName",{tableName:n,page:1,pageSize:d.value}),s({tableName:n,page:1,pageSize:d.value})}),U($,n=>{n.length>0&&(m.value=Object.keys(n[0]).filter(a=>a!=="_id"),console.log("columns",m.value))},{immediate:!0}),U(()=>r,n=>{o.value=n}),U(k,n=>{h("update:loading",n)}),(n,a)=>{const j=T("NvaButton"),G=T("NvaPagination");return u(),f("div",Be,[e("div",De,[M(e("textarea",{"onUpdate:modelValue":a[0]||(a[0]=R=>w.value=R),"default-value":w.value,placeholder:"输入 SQL 查询...",class:"w-full h-24 p-2 border border-gray-300 rounded-md text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,8,Ee),[[z,w.value]]),e("div",ze,[y(j,{onClick:t},{default:S(()=>a[2]||(a[2]=[B("运行")])),_:1})])]),e("div",qe,[e("div",null,[a[4]||(a[4]=e("span",{class:"mr-2"},"每页显示:",-1)),M(e("select",{"onUpdate:modelValue":a[1]||(a[1]=R=>d.value=R),onChange:l,class:"border border-gray-300 px-2 py-1 text-sm"},a[3]||(a[3]=[e("option",{value:10},"10",-1),e("option",{value:20},"20",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),544),[[H,d.value]])]),y(j,{onClick:i,disabled:!C.value.length},{default:S(()=>a[5]||(a[5]=[B("保存更改")])),_:1},8,["disabled"])]),y(Le,{columns:m.value,list:I($),"onUpdate:list":g},null,8,["columns","list"]),y(G,{hook:I(N)},null,8,["hook"])])}}},Ae=A(Ie,[["__scopeId","data-v-c04f2bd2"]]),Re={class:"flex flex-col lg:flex-row box-wrapper"},He=["onClick"],Oe={class:"flex-grow truncate"},je={__name:"Console",setup(p){const _=c([]),b=c(null),h=c(!0),m=c(!1),x=c(0),d=async()=>{h.value=!0;const k=await Z();_.value=k.data.data,h.value=!1},w=async k=>{b.value=k};O(()=>{d()});const C=c(!1),N=c(""),$=async()=>{if(!N.value)return NvaMessage.error("请输入表名");h.value=!0,await oe(N.value),await d(),h.value=!1};return(k,s)=>{const v=T("a-spin"),r=T("BoxView"),o=T("NvaTab"),l=T("a-empty"),i=T("NvaInput"),g=T("NvaModal");return u(),f(V,null,[e("div",Re,[y(r,{class:"w-full lg:w-1/5 lg:mr-4"},{default:S(()=>[y(v,{loading:h.value,class:"w-full h-full"},{default:S(()=>[(u(!0),f(V,null,L(_.value,(t,n)=>(u(),f("div",{onClick:a=>w(t.name),class:Q(["flex flex-row items-center hover:bg-gray-100 p-2 rounded-md cursor-pointer active:bg-gray-200",b.value==t.name&&"bg-gray-200"]),key:n},[y(I(Y),{size:"24",class:"mr-2 flex-shrink-0"}),e("span",Oe,q(t.name),1)],10,He))),128)),e("div",{onClick:s[0]||(s[0]=t=>C.value=!0),class:"flex flex-row items-center hover:bg-gray-100 p-2 rounded-md cursor-pointer active:bg-gray-200"},[y(I(F),{size:"24",class:"mr-2 flex-shrink-0"}),s[6]||(s[6]=e("span",{class:"flex-grow truncate"},"新建表",-1))])]),_:1},8,["loading"])]),_:1}),y(r,{class:"boxRight"},{default:S(()=>[y(v,{loading:m.value,class:"w-full h-full"},{default:S(()=>[b.value?(u(),f(V,{key:0},[y(o,{tabs:["表结构","数据"],tabIndex:x.value,"onUpdate:tabIndex":s[1]||(s[1]=t=>x.value=t)},null,8,["tabIndex"]),x.value==0?(u(),E(Ne,{key:0,tableName:b.value,loading:m.value,"onUpdate:loading":s[2]||(s[2]=t=>m.value=t)},null,8,["tableName","loading"])):P("",!0),x.value==1?(u(),E(Ae,{key:1,tableName:b.value,loading:m.value,"onUpdate:loading":s[3]||(s[3]=t=>m.value=t)},null,8,["tableName","loading"])):P("",!0)],64)):(u(),E(l,{key:1,class:"w-full h-full flex items-center justify-center"}))]),_:1},8,["loading"])]),_:1})]),y(g,{modelValue:C.value,"onUpdate:modelValue":s[5]||(s[5]=t=>C.value=t),title:"新建表",onOk:$},{default:S(()=>[y(i,{modelValue:N.value,"onUpdate:modelValue":s[4]||(s[4]=t=>N.value=t),placeholder:"请输入表名"},null,8,["modelValue"])]),_:1},8,["modelValue"])],64)}}},Ke=A(je,[["__scopeId","data-v-18652776"]]);export{Ke as default};
