import{e as V,d as S,g as M,f as w,i as q,o as v,b as y,n as P,h as R,a,_ as fe,I as W,v as pe,x as me,c as G,y as ve,l as g,r as b,z as $,u as K,k as _,j as p,w as k,A as C,m as ge,B as ke,C as ye,F as z,D as be,p as Z,E as Ce,G as $e,H as D,q as _e}from"./index-D97R-yDI.js";import{B as we}from"./BoxView-BOZRrbQt.js";import{I as Fe}from"./index-Dcqgj-XU.js";import{i as j}from"./index-CrRbIKnp.js";const he=S({name:"IconCode",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:t}){const n=M("icon"),i=w(()=>[n,`${n}-code`,{[`${n}-spin`]:e.spin}]),c=w(()=>{const s={};return e.size&&(s.fontSize=q(e.size)?`${e.size}px`:e.size),e.rotate&&(s.transform=`rotate(${e.rotate}deg)`),s});return{cls:i,innerStyle:c,onClick:s=>{t("click",s)}}}}),xe=["stroke-width","stroke-linecap","stroke-linejoin"],Ie=a("path",{d:"M16.734 12.686 5.42 24l11.314 11.314m14.521-22.628L42.57 24 31.255 35.314M27.2 6.28l-6.251 35.453"},null,-1),Le=[Ie];function De(e,t,n,i,c,u){return v(),y("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:P(e.cls),style:R(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:t[0]||(t[0]=(...s)=>e.onClick&&e.onClick(...s))},Le,14,xe)}var N=V(he,[["render",De]]);const Se=Object.assign(N,{install:(e,t)=>{var n;const i=(n=t==null?void 0:t.iconPrefix)!=null?n:"";e.component(i+N.name,N)}}),je=S({name:"IconCommon",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:t}){const n=M("icon"),i=w(()=>[n,`${n}-common`,{[`${n}-spin`]:e.spin}]),c=w(()=>{const s={};return e.size&&(s.fontSize=q(e.size)?`${e.size}px`:e.size),e.rotate&&(s.transform=`rotate(${e.rotate}deg)`),s});return{cls:i,innerStyle:c,onClick:s=>{t("click",s)}}}}),ze=["stroke-width","stroke-linecap","stroke-linejoin"],Ne=a("path",{d:"M24 23 7.652 14.345M24 23l16.366-8.664M24 23v19.438M7 14v20l17 9 17-9V14L24 5 7 14Z"},null,-1),Be=[Ne];function Ue(e,t,n,i,c,u){return v(),y("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:P(e.cls),style:R(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:t[0]||(t[0]=(...s)=>e.onClick&&e.onClick(...s))},Be,14,ze)}var B=V(je,[["render",Ue]]);const Ve=Object.assign(B,{install:(e,t)=>{var n;const i=(n=t==null?void 0:t.iconPrefix)!=null?n:"";e.component(i+B.name,B)}}),Me=S({name:"IconFolder",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:t}){const n=M("icon"),i=w(()=>[n,`${n}-folder`,{[`${n}-spin`]:e.spin}]),c=w(()=>{const s={};return e.size&&(s.fontSize=q(e.size)?`${e.size}px`:e.size),e.rotate&&(s.transform=`rotate(${e.rotate}deg)`),s});return{cls:i,innerStyle:c,onClick:s=>{t("click",s)}}}}),qe=["stroke-width","stroke-linecap","stroke-linejoin"],Pe=a("path",{d:"M6 13h18l-2.527-3.557a1.077 1.077 0 0 0-.88-.443H7.06C6.474 9 6 9.448 6 10v3Zm0 0h33.882c1.17 0 2.118.895 2.118 2v21c0 1.105-.948 3-2.118 3H8.118C6.948 39 6 38.105 6 37V13Z"},null,-1),Re=[Pe];function Te(e,t,n,i,c,u){return v(),y("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:P(e.cls),style:R(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:t[0]||(t[0]=(...s)=>e.onClick&&e.onClick(...s))},Re,14,qe)}var U=V(Me,[["render",Te]]);const Ae=Object.assign(U,{install:(e,t)=>{var n;const i=(n=t==null?void 0:t.iconPrefix)!=null?n:"";e.component(i+U.name,U)}}),Ee=S({name:"IconFile",props:{fileName:{type:String,required:!0},type:{type:Number,default:0}},setup(e){const t=i=>i.split(".").pop().toLowerCase();return{iconComponent:w(()=>{if(e.type===0)return Ae;switch(t(e.fileName)){case"pdf":case"doc":case"docx":case"txt":return W;case"jpg":case"jpeg":case"png":case"gif":return Fe;case"mp4":case"avi":case"mov":return me;case"mp3":case"wav":return pe;case"zip":case"rar":return Ve;case"js":case"vue":case"py":case"java":return Se;default:return W}})}}});function Oe(e,t,n,i,c,u){return v(),G(ve(e.iconComponent))}const We=fe(Ee,[["render",Oe]]),Ze=e=>j.get("/api/files/list",{params:{...e}}),He=e=>j.post("/api/files/create-folder",{...e}),H=e=>{const t=new FormData;return t.append("file",e.file),t.append("dir",e.dir),j.post("/api/files/upload",t,{headers:{"Content-Type":"multipart/form-data"}})},Ge=e=>j.post("/api/files/delete",{...e}),Ke="https://oss.cnzoe.com",Je={key:0,class:"space-y-4"},Qe=["href"],Xe={class:"text-blue-500 hover:text-blue-700 underline"},Ye={key:1},et={__name:"FileInfo",props:{file:{type:Object,required:!0}},emits:["fileDeleted"],setup(e,{emit:t}){const n=e,i=t,c=g(!1),u=async d=>{c.value=!0;try{if((await Ge({fileId:n.file.id})).data.success)C.success("删除成功"),i("fileDeleted",{success:!0,fileId:n.file.id}),d();else throw new Error("删除失败")}catch(r){C.error("删除失败："+r.message),i("fileDeleted",{success:!1,fileId:n.file.id,error:r.message}),d(!1)}finally{c.value=!1}},s=d=>d<1024?d+" B":d<1024*1024?(d/1024).toFixed(2)+" KB":d<1024*1024*1024?(d/(1024*1024)).toFixed(2)+" MB":(d/(1024*1024*1024)).toFixed(2)+" GB",h=d=>new Date(d).toLocaleString();return(d,r)=>{const L=b("a-button"),F=b("a-popconfirm");return v(),y("div",null,[r[8]||(r[8]=a("h2",{class:"text-xl font-bold mb-4"},"File Information",-1)),e.file?(v(),y("div",Je,[a("a",{href:`${K(Ke)}${e.file.full_path}`,target:"_blank",class:"block"},[r[0]||(r[0]=a("p",{class:"mb-1"},[a("strong",null,"Name:")],-1)),a("span",Xe,$(e.file.file_name),1)],8,Qe),a("p",null,[r[1]||(r[1]=a("strong",null,"Type:",-1)),_(" "+$(e.file.type===0?"Folder":"File"),1)]),a("p",null,[r[2]||(r[2]=a("strong",null,"Full Path:",-1)),_(" "+$(e.file.full_path),1)]),a("p",null,[r[3]||(r[3]=a("strong",null,"Size:",-1)),_(" "+$(s(e.file.file_size)),1)]),a("p",null,[r[4]||(r[4]=a("strong",null,"File Type:",-1)),_(" "+$(e.file.file_type),1)]),a("p",null,[r[5]||(r[5]=a("strong",null,"Created At:",-1)),_(" "+$(h(e.file.created_at)),1)]),a("p",null,[r[6]||(r[6]=a("strong",null,"Updated At:",-1)),_(" "+$(h(e.file.updated_at)),1)]),p(F,{content:"确认删除此文件吗？",type:"warning","ok-loading":c.value,onBeforeOk:u},{default:k(()=>[p(L,{type:"primary",class:"mt-6"},{default:k(()=>r[7]||(r[7]=[_("删除")])),_:1})]),_:1},8,["ok-loading"])])):(v(),y("div",Ye," No file information available. "))])}}},tt=["onClick"],nt={class:"text-sm text-center truncate w-full block"},ot={key:0,class:"absolute inset-0 bg-blue-500 bg-opacity-50 flex items-center justify-center"},lt={class:"text-sm text-gray-500 mb-4"},ct={__name:"FileList",setup(e){const t=_e(),n=be(),i=g([]),c=g(!1),u=g("/"),s=g(!1),h=g(!1),d=g(""),r=g(!1),L=g(null),F=g(!1),I=g(0),T=g(null),J=w(()=>{const o=u.value.split("/").filter(Boolean);return o.map((l,m)=>({name:l,path:"/"+o.slice(0,m+1).join("/")}))}),A=o=>{t.push({query:{dir:encodeURIComponent(o)}})};ge(()=>{const o=n.query.dir;o&&(u.value=decodeURIComponent(o)),x(u.value)}),ke(()=>n.query.dir,o=>{o&&(u.value=decodeURIComponent(o),x(u.value))});const Q=async(o,l,m)=>{o===0?await t.push({query:{dir:encodeURIComponent(l)}}):(T.value=m,s.value=!0)},x=async o=>{c.value=!0;try{const l=await Ze({dir:o});i.value=l.data.data,u.value=o}catch(l){C.error("获取文件列表失败："+l.message)}finally{c.value=!1}},X=()=>{h.value=!0},Y=async()=>{if(!/^[a-zA-Z0-9_-]+$/.test(d.value)){C.warning("文件夹名称只能包含字母、数字、下划线和横杠");return}c.value=!0;const o=await He({dir:u.value,folder:d.value});o.data.success?(C.success("新建文件夹成功"),await x(u.value)):C.error(o.data.message),c.value=!1},ee=o=>{o.preventDefault(),I.value++,I.value===1&&(r.value=!0)},te=o=>{o.preventDefault(),I.value--,I.value===0&&(r.value=!1)},ne=async o=>{o.preventDefault(),r.value=!1,I.value=0;const l=Array.from(o.dataTransfer.files);F.value=!0;try{for(const m of l)await H({file:m,dir:u.value});C.success("Files uploaded successfully"),await x(u.value)}catch(m){C.error("Error uploading files"),console.error("Upload error:",m)}finally{F.value=!1}},oe=()=>{L.value.click()},le=async o=>{const l=Array.from(o.target.files);F.value=!0;try{for(const m of l)await H({file:m,dir:u.value});C.success("Files uploaded successfully"),await x(u.value)}catch(m){C.error("Error uploading files"),console.error("Upload error:",m)}finally{F.value=!1,o.target.value=""}},se=async({success:o,fileId:l})=>{o&&(s.value=!1,await x(u.value))};return(o,l)=>{const m=b("a-button"),re=b("a-space"),ae=b("TitleLine"),E=b("a-breadcrumb-item"),ie=b("a-breadcrumb"),ue=b("a-spin"),ce=b("a-input"),de=b("a-modal");return v(),y(z,null,[p(ae,{title:"File List"},{right:k(()=>[p(re,null,{default:k(()=>[p(m,{type:"primary",onClick:X},{default:k(()=>l[5]||(l[5]=[_("新建文件夹")])),_:1})]),_:1})]),_:1}),p(ue,{class:"w-full",loading:c.value||F.value},{default:k(()=>[p(we,null,{default:k(()=>[p(ie,{class:"mb-4"},{default:k(()=>[p(E,{onClick:l[0]||(l[0]=f=>A("/"))},{default:k(()=>l[6]||(l[6]=[_("Root")])),_:1}),(v(!0),y(z,null,Z(J.value,(f,O)=>(v(),G(E,{key:O,onClick:st=>A(f.path)},{default:k(()=>[_($(f.name),1)]),_:2},1032,["onClick"]))),128))]),_:1}),a("div",{class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 auto-rows-auto relative",onDragenter:D(ee,["prevent"]),onDragover:l[1]||(l[1]=D(()=>{},["prevent"])),onDragleave:D(te,["prevent"]),onDrop:D(ne,["prevent"])},[(v(!0),y(z,null,Z(i.value,f=>(v(),y("div",{onClick:O=>Q(f.type,f.full_path,f),key:f.id,class:"flex flex-col items-center p-2 border rounded cursor-pointer active:opacity-50"},[p(We,{size:"24",type:f.type,fileName:f.path},null,8,["type","fileName"]),a("span",nt,$(f.path),1)],8,tt))),128)),a("div",{class:"flex flex-col items-center p-2 border rounded cursor-pointer active:opacity-50",onClick:oe},[p(K(Ce),{size:"24",class:"mb-2"}),l[7]||(l[7]=a("span",{class:"text-sm text-center break-words"},"上传",-1))]),r.value?(v(),y("div",ot,l[8]||(l[8]=[a("p",{class:"text-white text-xl font-bold"},"Drop files here to upload",-1)]))):$e("",!0)],32)]),_:1})]),_:1},8,["loading"]),a("input",{type:"file",ref_key:"fileInput",ref:L,onChange:le,style:{display:"none"},multiple:""},null,544),p(de,{visible:h.value,"onUpdate:visible":l[3]||(l[3]=f=>h.value=f),title:"新建文件夹",onOk:Y},{default:k(()=>[a("div",lt,"当前目录："+$(u.value),1),p(ce,{modelValue:d.value,"onUpdate:modelValue":l[2]||(l[2]=f=>d.value=f),placeholder:"请输入文件夹名称"},null,8,["modelValue"])]),_:1},8,["visible"]),p(ye,{visible:s.value,"onUpdate:visible":l[4]||(l[4]=f=>s.value=f)},{default:k(()=>[p(et,{file:T.value,onFileDeleted:se},null,8,["file"])]),_:1},8,["visible"])],64)}}};export{ct as default};
