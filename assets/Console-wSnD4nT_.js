import{a as K,m as X,g as F,u as Q,b as J,d as Y}from"./db-BH0P3Oyv.js";import{J as ee,K as te,L as ae,c as R,O as le,a as d,b as f,n as W,l as oe,e,_ as q,r as b,o as A,w as M,i as $,m as y,k as V,y as z,F as T,g as U,d as L,v as D,Y as j,t as E,h as ne,Z as se,j as B,a0 as re,p as H,V as ue,f as P}from"./index-5aWETVbQ.js";import{u as ie}from"./useList-DtciY06y.js";const de=te({name:"IconStorage",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:n=>["butt","round","square"].includes(n)},strokeLinejoin:{type:String,default:"miter",validator:n=>["arcs","bevel","miter","miter-clip","round"].includes(n)},rotate:Number,spin:Boolean},emits:{click:n=>!0},setup(n,{emit:_}){const i=ae("icon"),x=R(()=>[i,`${i}-storage`,{[`${i}-spin`]:n.spin}]),p=R(()=>{const s={};return n.size&&(s.fontSize=le(n.size)?`${n.size}px`:n.size),n.rotate&&(s.transform=`rotate(${n.rotate}deg)`),s});return{cls:x,innerStyle:p,onClick:s=>{_("click",s)}}}}),ce=["stroke-width","stroke-linecap","stroke-linejoin"],pe=e("path",{d:"M7 18h34v12H7V18ZM40 6H8a1 1 0 0 0-1 1v11h34V7a1 1 0 0 0-1-1ZM7 30h34v11a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V30Z"},null,-1),ve=e("path",{d:"M13.02 36H13v.02h.02V36Z"},null,-1),me=e("path",{d:"M13 12v-2h-2v2h2Zm.02 0h2v-2h-2v2Zm0 .02v2h2v-2h-2Zm-.02 0h-2v2h2v-2ZM13 14h.02v-4H13v4Zm-1.98-2v.02h4V12h-4Zm2-1.98H13v4h.02v-4Zm1.98 2V12h-4v.02h4Z",fill:"currentColor",stroke:"none"},null,-1),be=e("path",{d:"M13.02 24H13v.02h.02V24Z"},null,-1),xe=[pe,ve,me,be];function ge(n,_,i,x,p,v){return d(),f("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:W(n.cls),style:oe(n.innerStyle),"stroke-width":n.strokeWidth,"stroke-linecap":n.strokeLinecap,"stroke-linejoin":n.strokeLinejoin,onClick:_[0]||(_[0]=(...s)=>n.onClick&&n.onClick(...s))},xe,14,ce)}var I=ee(de,[["render",ge]]);const fe=Object.assign(I,{install:(n,_)=>{var i;const x=(i=_==null?void 0:_.iconPrefix)!=null?i:"";n.component(x+I.name,I)}}),he={class:"overflow-x-auto"},_e={class:"flex flex-row justify-end"},ye={class:"table-wrapper",id:"table-wrapper"},we={class:"w-full border border-gray-300 text-sm"},ke={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},Ce=["onUpdate:modelValue","onChange"],Ne={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},$e=["onUpdate:modelValue","onChange"],Se=["value"],Ve={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},Te=["onUpdate:modelValue","onChange"],Me={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},Le=["onUpdate:modelValue","onChange"],Ue={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},ze={class:"hidden lg:block"},Be=["onClick"],De=["onClick"],Ee=["onClick"],He={class:"lg:hidden"},qe={__name:"TableStruct",props:{tableName:{type:String,default:""},loading:{type:Boolean,default:!1}},emits:["update:tableName","update:loading"],setup(n,{emit:_}){const i=n,x=_,p=b(null),v=b(null),s=["INTEGER","REAL","TEXT","BLOB","NULL","VARCHAR","CHAR","BOOLEAN","DATE","DATETIME"],w=async o=>{if(o){p.value=o,x("update:loading",!0);const l=await K(o);v.value=l.data.data.map(m=>({...m,_key:Date.now()+Math.random()})),x("update:loading",!1)}},k=o=>{const l={name:"",type:s[0],notnull:0,dflt_value:"",_key:Date.now()+Math.random()};v.value.splice(o,0,l)},N=o=>{const l={name:"",type:s[0],notnull:0,dflt_value:"",_key:Date.now()+Math.random()};v.value.splice(o+1,0,l)},S=o=>{v.value.splice(o,1)},C=async()=>{console.log("修改后的表结构:",v.value),x("update:loading",!0),await X(p.value,v.value),await w(p.value),NvaMessage.success("保存成功"),x("update:loading",!1)},r=o=>{o._key=Date.now()+Math.random()},g=()=>{const o=document.querySelector("#table-container"),l=document.querySelector("#table-wrapper");console.log("xxxxxxxxxxxxxxxx",o.clientHeight),l.style.height=o.clientHeight+"px"},c=b(null);return A(()=>{new MutationObserver(l=>{console.log("监听tableContainer内容变化"),g()}).observe(c.value,{childList:!0,subtree:!0,characterData:!0})}),M(()=>i.tableName,o=>{w(o)},{immediate:!0}),(o,l)=>{const m=$("NvaButton"),h=$("a-button");return d(),f("div",he,[e("div",_e,[y(m,{onClick:C,class:"mb-2"},{default:V(()=>l[0]||(l[0]=[z("SAVE")])),_:1})]),e("div",ye,[e("div",{id:"table-container",class:"table-container",ref_key:"tableContainer",ref:c},[e("table",we,[l[3]||(l[3]=e("thead",null,[e("tr",{class:"bg-gray-100"},[e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 字段名"),e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 类型"),e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 不许为空"),e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 默认值"),e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 操作")])],-1)),e("tbody",null,[(d(!0),f(T,null,U(v.value,(t,u)=>(d(),f("tr",{key:t._key,class:"hover:bg-gray-50"},[e("td",ke,[L(e("input",{"onUpdate:modelValue":a=>t.name=a,class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:a=>r(t)},null,40,Ce),[[D,t.name,void 0,{lazy:!0}]])]),e("td",Ne,[L(e("select",{"onUpdate:modelValue":a=>t.type=a,class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:a=>r(t)},[(d(),f(T,null,U(s,a=>e("option",{key:a,value:a},E(a),9,Se)),64))],40,$e),[[j,t.type]])]),e("td",Ve,[L(e("select",{"onUpdate:modelValue":a=>t.notnull=a,class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:a=>r(t)},l[1]||(l[1]=[e("option",{value:1},"是",-1),e("option",{value:0},"否",-1)]),40,Te),[[j,t.notnull]])]),e("td",Me,[L(e("input",{"onUpdate:modelValue":a=>t.dflt_value=a,placeholder:"NULL",class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:a=>r(t)},null,40,Le),[[D,t.dflt_value,void 0,{lazy:!0}]])]),e("td",Ue,[e("div",ze,[e("button",{onClick:a=>k(u),class:"text-blue-600 hover:text-blue-800 mr-1 text-xs"},"前增",8,Be),e("button",{onClick:a=>N(u),class:"text-blue-600 hover:text-blue-800 mr-1 text-xs"},"后增",8,De),e("button",{onClick:a=>S(u),class:"text-red-600 hover:text-red-800 text-xs"},"删除",8,Ee)]),e("div",He,[y(h,{size:"mini",type:"text"},{default:V(()=>l[2]||(l[2]=[z("操作")])),_:1})])])]))),128))])])],512)])])}}},Ze=q(qe,[["__scopeId","data-v-1968e7a8"]]),Ie={class:"table-wrapper",id:"table-wrapper"},je={class:"w-full border-collapse"},Ae=["onMousedown"],Oe=["onDblclick"],Re=["onUpdate:modelValue","onBlur","onKeyup"],Pe={__name:"Datas",props:{columns:{type:Array,required:!0,default:()=>[]},list:{type:Array,required:!0,default:()=>[]}},emits:["update:list"],setup(n,{emit:_}){const i=n,x=_,p=b(null),v=b(null),s=b([]),w=b(null),k=(g,c)=>p.value===g&&v.value===c,N=(g,c)=>{p.value=g,v.value=c},S=(g,c)=>{const o=i.list[g],l=s.value.findIndex(m=>m.id===o.id);l!==-1?s.value[l]={...s.value[l],[c]:o[c]}:s.value.push({id:o.id,[c]:o[c]}),console.log(s.value),x("update:list",s.value),p.value=null,v.value=null},C=(g,c)=>{const o=g.target.closest("th"),l=g.pageX,m=o.offsetWidth,h=u=>{console.log(o);const a=m+u.pageX-l;o.style.width=`${a}px`},t=()=>{document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",t)};document.addEventListener("mousemove",h),document.addEventListener("mouseup",t)},r=()=>{const g=document.querySelector("#table-container"),c=document.querySelector("#table-wrapper");c.style.height=g.clientHeight+"px"};return M(i.list,()=>{ne(()=>{r()})}),A(()=>{new MutationObserver(c=>{r()}).observe(w.value,{childList:!0,subtree:!0,characterData:!0})}),se(()=>{}),(g,c)=>{const o=$("NvaTextScroll");return d(),f("div",Ie,[e("div",{id:"table-container",class:"table-container",ref_key:"tableContainer",ref:w},[e("table",je,[e("thead",null,[e("tr",null,[(d(!0),f(T,null,U(n.columns,l=>(d(),f("th",{key:l,class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"},[z(E(l)+" ",1),e("div",{class:"resize-handle",onMousedown:m=>C(m)},null,40,Ae)]))),128))])]),e("tbody",null,[(d(!0),f(T,null,U(n.list,(l,m)=>(d(),f("tr",{key:m},[(d(!0),f(T,null,U(n.columns,h=>(d(),f("td",{key:`${m}-${h}`,class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate",onDblclick:t=>N(m,h)},[k(m,h)?L((d(),f("input",{key:1,"onUpdate:modelValue":t=>l[h]=t,onBlur:t=>S(m,h),onKeyup:re(t=>S(m,h),["enter"]),class:"w-full px-1 py-0.5 text-xs border-none focus:outline-none focus:ring-1 focus:ring-blue-500",ref_for:!0,ref:t=>{t&&t.focus()}},null,40,Re)),[[D,l[h]]]):(d(),B(o,{key:`text_${l.id}`,start:"hover"},{default:V(()=>[z(E(l[h]),1)]),_:2},1024))],40,Oe))),128))]))),128))])])],512)])}}},We=q(Pe,[["__scopeId","data-v-871d2873"]]),Ge={class:"w-full"},Ke={class:"mb-4"},Xe=["default-value"],Fe={class:"mt-2 flex justify-end"},Qe={class:"flex flex-row justify-between mb-2"},Je={__name:"TableDatas",props:{tableName:{type:String,required:!0},loading:{type:Boolean,default:!1}},emits:["update:loading"],setup(n,{emit:_}){const i=n,x=_,p=b([]),v=b(!1),s=b(20),w=b(""),k=b([]),N=ie(F,{tableName:i.tableName}),{list:S,loading:C,refresh:r,result:g,page:c}=N;M(g,u=>{w.value=u.sql});const o=b(1),l=()=>{r({page:1,pageSize:s.value,tableName:i.tableName},!0)},m=async()=>{C.value=!0;try{console.log(S.value),await Q(i.tableName,{data:k.value}),r(),k.value=[],v.value=!1,NvaMessage.success("保存成功")}catch(u){console.error("Error saving changes:",u),NvaMessage.error("保存失败")}finally{C.value=!1}},h=u=>{k.value=u,console.log("newList",u)},t=async()=>{console.log("sqlStr",w.value),await r({page:1,pageSize:s.value,tableName:i.tableName,sql:w.value},!0),NvaMessage.success("查询成功")};return M(()=>i.tableName,u=>{console.log("newTableName",{tableName:u,page:1,pageSize:s.value}),r({tableName:u,page:1,pageSize:s.value},!0)}),M(S,u=>{u.length>0&&(p.value=Object.keys(u[0]).filter(a=>a!=="_id"),console.log("columns",p.value))},{immediate:!0}),M(()=>c,u=>{o.value=u}),M(C,u=>{x("update:loading",u)}),(u,a)=>{const O=$("NvaButton"),G=$("NvaPagination");return d(),f("div",Ge,[e("div",Ke,[L(e("textarea",{"onUpdate:modelValue":a[0]||(a[0]=Z=>w.value=Z),"default-value":w.value,placeholder:"输入 SQL 查询...",class:"w-full h-24 p-2 border border-gray-300 rounded-md text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,8,Xe),[[D,w.value]]),e("div",Fe,[y(O,{onClick:t},{default:V(()=>a[2]||(a[2]=[z("运行")])),_:1})])]),e("div",Qe,[e("div",null,[a[4]||(a[4]=e("span",{class:"mr-2"},"每页显示:",-1)),L(e("select",{"onUpdate:modelValue":a[1]||(a[1]=Z=>s.value=Z),onChange:l,class:"border border-gray-300 px-2 py-1 text-sm"},a[3]||(a[3]=[e("option",{value:10},"10",-1),e("option",{value:20},"20",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),544),[[j,s.value]])]),y(O,{onClick:m,disabled:!k.value.length},{default:V(()=>a[5]||(a[5]=[z("保存更改")])),_:1},8,["disabled"])]),y(We,{columns:p.value,list:H(S),"onUpdate:list":h},null,8,["columns","list"]),y(G,{hook:H(N)},null,8,["hook"])])}}},Ye=q(Je,[["__scopeId","data-v-f0cb6544"]]),et={class:"flex flex-col lg:flex-row box-wrapper"},tt=["onClick"],at={class:"flex-grow truncate"},lt={__name:"Console",setup(n){const _=b([]),i=b(null),x=b(!0),p=b(!1),v=b(0),s=async()=>{x.value=!0;const C=await J();_.value=C.data.data,x.value=!1},w=async C=>{i.value=C};A(()=>{s()});const k=b(!1),N=b(""),S=async()=>{if(!N.value)return NvaMessage.error("请输入表名");x.value=!0,await Y(N.value),await s(),x.value=!1};return(C,r)=>{const g=$("a-spin"),c=$("BoxView"),o=$("NvaTab"),l=$("a-empty"),m=$("NvaInput"),h=$("NvaModal");return d(),f(T,null,[e("div",et,[y(c,{class:"w-full lg:w-1/5 lg:mr-4"},{default:V(()=>[y(g,{loading:x.value,class:"w-full h-full"},{default:V(()=>[(d(!0),f(T,null,U(_.value,(t,u)=>(d(),f("div",{onClick:a=>w(t.name),class:W(["flex flex-row items-center hover:bg-gray-100 p-2 rounded-md cursor-pointer active:bg-gray-200",i.value==t.name&&"bg-gray-200"]),key:u},[y(H(fe),{size:"24",class:"mr-2 flex-shrink-0"}),e("span",at,E(t.name),1)],10,tt))),128)),e("div",{onClick:r[0]||(r[0]=t=>k.value=!0),class:"flex flex-row items-center hover:bg-gray-100 p-2 rounded-md cursor-pointer active:bg-gray-200"},[y(H(ue),{size:"24",class:"mr-2 flex-shrink-0"}),r[6]||(r[6]=e("span",{class:"flex-grow truncate"},"新建表",-1))])]),_:1},8,["loading"])]),_:1}),y(c,{class:"boxRight"},{default:V(()=>[y(g,{loading:p.value,class:"w-full h-full"},{default:V(()=>[i.value?(d(),f(T,{key:0},[y(o,{tabs:["表结构","数据"],tabIndex:v.value,"onUpdate:tabIndex":r[1]||(r[1]=t=>v.value=t)},null,8,["tabIndex"]),v.value==0?(d(),B(Ze,{key:0,tableName:i.value,loading:p.value,"onUpdate:loading":r[2]||(r[2]=t=>p.value=t)},null,8,["tableName","loading"])):P("",!0),v.value==1?(d(),B(Ye,{key:1,tableName:i.value,loading:p.value,"onUpdate:loading":r[3]||(r[3]=t=>p.value=t)},null,8,["tableName","loading"])):P("",!0)],64)):(d(),B(l,{key:1,class:"w-full h-full flex items-center justify-center"}))]),_:1},8,["loading"])]),_:1})]),y(h,{modelValue:k.value,"onUpdate:modelValue":r[5]||(r[5]=t=>k.value=t),title:"新建表",onOk:S},{default:V(()=>[y(m,{modelValue:N.value,"onUpdate:modelValue":r[4]||(r[4]=t=>N.value=t),placeholder:"请输入表名"},null,8,["modelValue"])]),_:1},8,["modelValue"])],64)}}},rt=q(lt,[["__scopeId","data-v-18652776"]]);export{rt as default};
