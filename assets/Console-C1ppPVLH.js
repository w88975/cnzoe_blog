import{i as P}from"./index-CqH2Op1u.js";import{r as h,f as H,O as D,h as V,o,a as i,e,j as C,w as S,v as I,F as $,k as E,z as U,S as j,T as X,t as B,m as K,c as te,u as O,U as ae,L as se,q as G,l as q,n as le}from"./index-BiPt_Lhb.js";import{u as oe}from"./useList-CbP_fCuo.js";import{I as ne}from"./index-Btt4RbEc.js";const re=()=>P.get("/api/db/tables"),de=g=>P.get(`/api/db/table/${g}`),ue=(g,_)=>P.post("/api/db/modify-table-structure",{tableName:g,newStructure:_}),ie=g=>{const{tableName:_,...c}=g;return P.post(`/api/db/table/data/${_}`,{...c})},F=(g,_)=>P.post(`/api/db/table/update/${g}`,{..._}),ce={class:"overflow-x-auto"},pe={class:"flex flex-row justify-end"},ve={class:"min-w-full border border-gray-300 text-sm"},be={class:"border border-gray-300 px-1 py-1"},me=["onUpdate:modelValue","onChange"],ge={class:"border border-gray-300 px-1 py-1"},_e=["onUpdate:modelValue","onChange"],xe=["value"],ye={class:"border border-gray-300 px-1 py-1"},he=["onUpdate:modelValue","onChange"],fe={class:"border border-gray-300 px-1 py-1"},we=["onUpdate:modelValue","onChange"],Ce={class:"border px-1 py-1 text-center"},ke={class:"hidden lg:block"},$e=["onClick"],Ne=["onClick"],Te=["onClick"],Ve={class:"lg:hidden"},Se={__name:"TableStruct",props:{tableName:{type:String,default:""},loading:{type:Boolean,default:!1}},emits:["update:tableName","update:loading"],setup(g,{emit:_}){const c=g,f=_,b=h(null),r=h(null),v=["INTEGER","REAL","TEXT","BLOB","NULL","VARCHAR","CHAR","BOOLEAN","DATE","DATETIME"],x=async s=>{if(s){b.value=s,f("update:loading",!0);const a=await de(s);r.value=a.data.data.map(T=>({...T,_key:Date.now()+Math.random()})),f("update:loading",!1)}},m=s=>{const a={name:"",type:v[0],notnull:0,dflt_value:"",_key:Date.now()+Math.random()};r.value.splice(s,0,a)},p=s=>{const a={name:"",type:v[0],notnull:0,dflt_value:"",_key:Date.now()+Math.random()};r.value.splice(s+1,0,a)},k=s=>{r.value.splice(s,1)},N=async()=>{console.log("修改后的表结构:",r.value),f("update:loading",!0),await ue(b.value,r.value),await x(b.value),f("update:loading",!1)},y=s=>{s._key=Date.now()+Math.random()};return H(()=>{}),D(()=>c.tableName,s=>{x(s)},{immediate:!0}),(s,a)=>{const T=V("NvaButton"),R=V("a-button");return o(),i("div",ce,[e("div",pe,[C(T,{onClick:N,class:"mb-2"},{default:S(()=>a[0]||(a[0]=[I("SAVE")])),_:1})]),e("table",ve,[a[3]||(a[3]=e("thead",null,[e("tr",{class:"bg-gray-100"},[e("th",{class:"border border-gray-300 text-xs"},"字段名"),e("th",{class:"border border-gray-300 text-xs"},"类型"),e("th",{class:"border border-gray-300 text-xs"},"是否可空"),e("th",{class:"border border-gray-300 text-xs"},"默认值"),e("th",{class:"border border-gray-300 text-xs"},"操作")])],-1)),e("tbody",null,[(o(!0),i($,null,E(r.value,(d,M)=>(o(),i("tr",{key:d._key,class:"hover:bg-gray-50"},[e("td",be,[U(e("input",{"onUpdate:modelValue":l=>d.name=l,class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:l=>y(d)},null,40,me),[[j,d.name,void 0,{lazy:!0}]])]),e("td",ge,[U(e("select",{"onUpdate:modelValue":l=>d.type=l,class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:l=>y(d)},[(o(),i($,null,E(v,l=>e("option",{key:l,value:l},B(l),9,xe)),64))],40,_e),[[X,d.type]])]),e("td",ye,[U(e("select",{"onUpdate:modelValue":l=>d.notnull=l,class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:l=>y(d)},a[1]||(a[1]=[e("option",{value:1},"是",-1),e("option",{value:0},"否",-1)]),40,he),[[X,d.notnull]])]),e("td",fe,[U(e("input",{"onUpdate:modelValue":l=>d.dflt_value=l,placeholder:"NULL",class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:l=>y(d)},null,40,we),[[j,d.dflt_value,void 0,{lazy:!0}]])]),e("td",Ce,[e("div",ke,[e("button",{onClick:l=>m(M),class:"text-blue-600 hover:text-blue-800 mr-1 text-xs"},"前增",8,$e),e("button",{onClick:l=>p(M),class:"text-blue-600 hover:text-blue-800 mr-1 text-xs"},"后增",8,Ne),e("button",{onClick:l=>k(M),class:"text-red-600 hover:text-red-800 text-xs"},"删除",8,Te)]),e("div",Ve,[C(R,{size:"mini",type:"text"},{default:S(()=>a[2]||(a[2]=[I("操作")])),_:1})])])]))),128))])])])}}},Ue={class:"w-full"},Be={class:"flex flex-row justify-between mb-2"},Ee={class:"flex"},Me={class:"inline-block flex-1 min-w-full align-middle table-view"},ze={class:"min-w-full border border-gray-300 text-sm"},Le={class:"bg-gray-100"},De=["onMousedown"],Ie=["onUpdate:modelValue","onChange"],Pe={class:"border px-1 py-1 text-center"},Re=["onClick"],Ae=["onClick","disabled"],je={class:"flex justify-between items-center mt-4"},Oe={class:"text-sm"},Ge={class:"flex items-center"},Xe=["disabled"],qe=["max"],Fe={class:"mx-2 text-sm"},He=["disabled"],Ke={__name:"TableDatas",props:{tableName:{type:String,required:!0},loading:{type:Boolean,default:!1}},emits:["update:loading"],setup(g,{emit:_}){const c=g,f=_,b=h([]),r=h(!1),v=h(1),x=h(20),{list:m,loading:p,refresh:k,total:N}=oe(ie,{tableName:c.tableName}),y=te(()=>Math.ceil(N.value/x.value)),s=h(1),a=()=>{v.value>1&&d(v.value-1)},T=()=>{v.value<y.value&&d(v.value+1)},R=()=>{const t=Math.min(Math.max(1,s.value),y.value);d(t)},d=t=>{v.value=t,s.value=t,k({page:t,pageSize:x.value,tableName:c.tableName})},M=()=>{v.value=1,k({page:1,pageSize:x.value,tableName:c.tableName})},l=t=>{t._changed=!0,r.value=!0},W=t=>{m.value.splice(t,1),r.value=!0},J=async t=>{p.value=!0;try{await F(c.tableName,{data:[t]}),t._changed=!1,r.value=m.value.some(n=>n._changed)}catch(n){console.error("Error saving row:",n)}finally{p.value=!1}},Q=(t,n)=>{const A=t.target.closest("th"),u=t.pageX,z=A.offsetWidth,w=Z=>{const ee=z+Z.pageX-u;A.style.width=`${ee}px`},L=()=>{document.removeEventListener("mousemove",w),document.removeEventListener("mouseup",L)};document.addEventListener("mousemove",w),document.addEventListener("mouseup",L)},Y=async()=>{p.value=!0;try{console.log(m.value),await F(c.tableName,{data:m.value}),k(),r.value=!1}catch(t){console.error("Error saving changes:",t)}finally{p.value=!1}};return D(()=>c.tableName,t=>{console.log("newTableName",{tableName:t,page:1,pageSize:x.value}),k({tableName:t,page:1,pageSize:x.value})}),D(m,t=>{t.length>0&&(b.value=Object.keys(t[0]).filter(n=>n!=="_id"))},{immediate:!0}),D(()=>v.value,t=>{s.value=t}),D(p,t=>{f("update:loading",t)}),(t,n)=>{const A=V("NvaButton");return o(),i("div",Ue,[e("div",Be,[e("div",null,[n[3]||(n[3]=e("span",{class:"mr-2"},"每页显示:",-1)),U(e("select",{"onUpdate:modelValue":n[0]||(n[0]=u=>x.value=u),onChange:M,class:"border border-gray-300 px-2 py-1 text-sm"},n[2]||(n[2]=[e("option",{value:10},"10",-1),e("option",{value:20},"20",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),544),[[X,x.value]])]),C(A,{onClick:Y,disabled:!r.value},{default:S(()=>n[4]||(n[4]=[I("保存更改")])),_:1},8,["disabled"])]),e("div",Ee,[e("div",Me,[e("table",ze,[e("thead",null,[e("tr",Le,[(o(!0),i($,null,E(b.value,u=>(o(),i("th",{key:u,class:"border border-gray-300 text-xs px-2 py-1"},[I(B(u)+" ",1),e("div",{class:"resize-handle",onMousedown:z=>Q(z)},null,40,De)]))),128)),n[5]||(n[5]=e("th",{class:"border border-gray-300 text-xs px-2 py-1"},"操作",-1))])]),e("tbody",null,[(o(!0),i($,null,E(O(m),(u,z)=>(o(),i("tr",{key:u._id,class:"hover:bg-gray-50"},[(o(!0),i($,null,E(b.value,w=>(o(),i("td",{key:`${u._id}-${w}`,class:"border border-gray-300 px-1 py-1"},[w==="_id"?(o(),i($,{key:0},[I(B(u[w]),1)],64)):U((o(),i("input",{key:1,"onUpdate:modelValue":L=>u[w]=L,class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:L=>l(u)},null,40,Ie)),[[j,u[w]]])]))),128)),e("td",Pe,[e("button",{onClick:w=>W(z),class:"text-red-600 hover:text-red-800 text-xs mr-2"},"删除",8,Re),e("button",{onClick:w=>J(u),class:"text-blue-600 hover:text-blue-800 text-xs",disabled:!u._changed},"保存",8,Ae)])]))),128))])])])]),e("div",je,[e("span",Oe,"总记录数: "+B(O(N)),1),e("div",Ge,[e("button",{onClick:a,disabled:v.value===1,class:"px-2 py-1 mr-2 text-sm border rounded bg-white text-blue-500 disabled:opacity-50"}," 上一页 ",8,Xe),U(e("input",{"onUpdate:modelValue":n[1]||(n[1]=u=>s.value=u),onKeyup:ae(R,["enter"]),class:"w-16 px-2 py-1 text-sm border rounded text-center",type:"number",min:"1",max:y.value},null,40,qe),[[j,s.value,void 0,{number:!0}]]),e("span",Fe,"/ "+B(y.value),1),e("button",{onClick:T,disabled:v.value===y.value,class:"px-2 py-1 ml-2 text-sm border rounded bg-white text-blue-500 disabled:opacity-50"}," 下一页 ",8,He)])])])}}},We=K(Ke,[["__scopeId","data-v-f7e8c3c4"]]),Je={class:"flex flex-col lg:flex-row box-wrapper"},Qe=["onClick"],Ye={class:"flex-grow truncate"},Ze={class:"flex flex-row items-center hover:bg-gray-100 p-2 rounded-md cursor-pointer active:bg-gray-200"},et={__name:"Console",setup(g){const _=h([]),c=h(null),f=h(!0),b=h(!1),r=h(0),v=async()=>{f.value=!0;const m=await re();_.value=m.data.data,f.value=!1},x=async m=>{c.value=m};return H(()=>{v()}),(m,p)=>{const k=V("a-spin"),N=V("BoxView"),y=V("NavTab"),s=V("a-empty");return o(),i("div",Je,[C(N,{class:"w-full lg:w-1/5 lg:mr-4"},{default:S(()=>[C(k,{loading:f.value,class:"w-full h-full"},{default:S(()=>[(o(!0),i($,null,E(_.value,(a,T)=>(o(),i("div",{onClick:R=>x(a.name),class:le(["flex flex-row items-center hover:bg-gray-100 p-2 rounded-md cursor-pointer active:bg-gray-200",c.value==a.name&&"bg-gray-200"]),key:T},[C(O(ne),{size:"24",class:"mr-2 flex-shrink-0"}),e("span",Ye,B(a.name),1)],10,Qe))),128)),e("div",Ze,[C(O(se),{size:"24",class:"mr-2 flex-shrink-0"}),p[3]||(p[3]=e("span",{class:"flex-grow truncate"},"新建表",-1))])]),_:1},8,["loading"])]),_:1}),C(N,{class:"boxRight"},{default:S(()=>[C(k,{loading:b.value,class:"w-full h-full"},{default:S(()=>[c.value?(o(),i($,{key:0},[C(y,{tabs:["表结构","数据"],tabIndex:r.value,"onUpdate:tabIndex":p[0]||(p[0]=a=>r.value=a)},null,8,["tabIndex"]),r.value==0?(o(),G(Se,{key:0,tableName:c.value,loading:b.value,"onUpdate:loading":p[1]||(p[1]=a=>b.value=a)},null,8,["tableName","loading"])):q("",!0),r.value==1?(o(),G(We,{key:1,tableName:c.value,loading:b.value,"onUpdate:loading":p[2]||(p[2]=a=>b.value=a)},null,8,["tableName","loading"])):q("",!0)],64)):(o(),G(s,{key:1,class:"w-full h-full flex items-center justify-center"}))]),_:1},8,["loading"])]),_:1})])}}},ot=K(et,[["__scopeId","data-v-6f6f0a18"]]);export{ot as default};
