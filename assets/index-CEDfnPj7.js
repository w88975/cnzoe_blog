import{r as v,f as D,a as s,e,j as C,w as k,z as u,Q as m,F as g,k as _,l as M,h as $,o as r,v as w,t as T,R as V}from"./index-VxQDhg_p.js";import{i as h}from"./index-DkEpIBX_.js";const L=()=>h.get("/api/db/tables"),R=i=>h.get(`/api/db/table/${i}`),S=(i,p)=>h.post("/api/db/modify-table-structure",{tableName:i,newStructure:p}),z={class:"mt-4"},G=["value"],O={key:0,class:"mt-4"},F={class:"min-w-full border border-gray-300"},H={class:"border border-gray-300 px-4 py-2"},I=["onUpdate:modelValue","onChange"],j={class:"border border-gray-300 px-4 py-2"},q=["onUpdate:modelValue","onChange"],Q=["value"],X={class:"border border-gray-300 px-4 py-2"},J=["onUpdate:modelValue","onChange"],K={class:"border border-gray-300 px-4 py-2"},P=["onUpdate:modelValue","onChange"],W={class:"border border-gray-300 px-4 py-2"},Y=["onClick"],Z=["onClick"],ee=["onClick"],ae={__name:"index",setup(i){const p=v([]),d=v(null),n=v(null),c=["INTEGER","REAL","TEXT","BLOB","NULL","VARCHAR","CHAR","BOOLEAN","DATE","DATETIME"],x=async()=>{const l=await L();p.value=l.data.data},U=async()=>{if(d.value){const l=await R(d.value);n.value=l.data.data.map(t=>({...t,_key:Date.now()+Math.random()}))}},B=l=>{const t={name:"",type:c[0],notnull:0,dflt_value:"",_key:Date.now()+Math.random()};n.value.splice(l,0,t)},E=l=>{const t={name:"",type:c[0],notnull:0,dflt_value:"",_key:Date.now()+Math.random()};n.value.splice(l+1,0,t)},N=l=>{n.value.splice(l,1)},A=()=>{console.log("修改后的表结构:",n.value),S(d.value,n.value)},b=l=>{l._key=Date.now()+Math.random()};return D(()=>{x()}),(l,t)=>{const f=$("NvaButton");return r(),s("div",null,[t[7]||(t[7]=e("h1",{class:"text-2xl font-bold"},"数据库",-1)),e("div",null,[C(f,{onClick:x,class:"mb-4"},{default:k(()=>t[1]||(t[1]=[w("获取表结构")])),_:1}),e("div",z,[u(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>d.value=o),onChange:U,class:"block w-full px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[t[2]||(t[2]=e("option",{value:"",disabled:"",selected:""},"选择一个表",-1)),(r(!0),s(g,null,_(p.value,o=>(r(),s("option",{key:o.name,value:o.name},T(o.name),9,G))),128))],544),[[m,d.value]])]),n.value?(r(),s("div",O,[t[6]||(t[6]=e("h2",{class:"text-xl font-semibold"},"表结构",-1)),e("table",F,[t[4]||(t[4]=e("thead",null,[e("tr",{class:"bg-gray-100"},[e("th",{class:"border border-gray-300 px-4 py-2"},"字段名"),e("th",{class:"border border-gray-300 px-4 py-2"},"类型"),e("th",{class:"border border-gray-300 px-4 py-2"},"是否可空"),e("th",{class:"border border-gray-300 px-4 py-2"},"默认值"),e("th",{class:"border border-gray-300 px-4 py-2"},"操作")])],-1)),e("tbody",null,[(r(!0),s(g,null,_(n.value,(o,y)=>(r(),s("tr",{key:o._key,class:"hover:bg-gray-50"},[e("td",H,[u(e("input",{"onUpdate:modelValue":a=>o.name=a,class:"border border-gray-300 rounded-md w-full px-2 py-1",onChange:a=>b(o)},null,40,I),[[V,o.name,void 0,{lazy:!0}]])]),e("td",j,[u(e("select",{"onUpdate:modelValue":a=>o.type=a,class:"border border-gray-300 rounded-md w-full px-2 py-1",onChange:a=>b(o)},[(r(),s(g,null,_(c,a=>e("option",{key:a,value:a},T(a),9,Q)),64))],40,q),[[m,o.type]])]),e("td",X,[u(e("select",{"onUpdate:modelValue":a=>o.notnull=a,class:"border border-gray-300 rounded-md w-full px-2 py-1",onChange:a=>b(o)},t[3]||(t[3]=[e("option",{value:1},"是",-1),e("option",{value:0},"否",-1)]),40,J),[[m,o.notnull]])]),e("td",K,[u(e("input",{"onUpdate:modelValue":a=>o.dflt_value=a,class:"border border-gray-300 rounded-md w-full px-2 py-1",onChange:a=>b(o)},null,40,P),[[V,o.dflt_value,void 0,{lazy:!0}]])]),e("td",W,[e("button",{onClick:a=>B(y),class:"text-blue-600 hover:text-blue-800 underline mr-2"},"往前新增",8,Y),e("button",{onClick:a=>E(y),class:"text-blue-600 hover:text-blue-800 underline mr-2"},"往后新增",8,Z),e("button",{onClick:a=>N(y),class:"text-red-600 hover:text-red-800 underline"},"删除",8,ee)])]))),128))])]),C(f,{onClick:A,class:"mt-4"},{default:k(()=>t[5]||(t[5]=[w("保存修改")])),_:1})])):M("",!0)])])}}};export{ae as default};
