import{i as D}from"./index-B5UV0Fk5.js";import{m as A,r as b,f as O,O as U,h as T,o as n,a as v,e,j as C,w as S,v as B,F as V,k as M,z as L,S as E,T as H,t as z,x as W,U as X,V as K,u as q,L as F,q as R,l as P,n as Q}from"./index-CNnRx2io.js";import{u as J}from"./useList-DEHcBd60.js";import{I as Y}from"./index-BRY4BtOA.js";const Z=()=>D.get("/api/db/tables"),ee=x=>D.get(`/api/db/table/${x}`),te=(x,f)=>D.post("/api/db/modify-table-structure",{tableName:x,newStructure:f}),ae=x=>{const{tableName:f,...u}=x;return D.post(`/api/db/table/data/${f}`,{...u})},le=(x,f)=>D.post(`/api/db/table/update/${x}`,{...f}),se={class:"overflow-x-auto"},oe={class:"flex flex-row justify-end"},ne={class:"table-wrapper",id:"table-wrapper"},re={class:"w-full border border-gray-300 text-sm"},ue={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},de=["onUpdate:modelValue","onChange"],ie={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},ce=["onUpdate:modelValue","onChange"],pe=["value"],ve={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},be=["onUpdate:modelValue","onChange"],xe={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},ge=["onUpdate:modelValue","onChange"],me={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},fe={class:"hidden lg:block"},_e=["onClick"],ye=["onClick"],he=["onClick"],we={class:"lg:hidden"},Ce={__name:"TableStruct",props:{tableName:{type:String,default:""},loading:{type:Boolean,default:!1}},emits:["update:tableName","update:loading"],setup(x,{emit:f}){const u=x,k=f,g=b(null),d=b(null),r=["INTEGER","REAL","TEXT","BLOB","NULL","VARCHAR","CHAR","BOOLEAN","DATE","DATETIME"],_=async t=>{if(t){g.value=t,k("update:loading",!0);const a=await ee(t);d.value=a.data.data.map(c=>({...c,_key:Date.now()+Math.random()})),k("update:loading",!1)}},w=t=>{const a={name:"",type:r[0],notnull:0,dflt_value:"",_key:Date.now()+Math.random()};d.value.splice(t,0,a)},m=t=>{const a={name:"",type:r[0],notnull:0,dflt_value:"",_key:Date.now()+Math.random()};d.value.splice(t+1,0,a)},N=t=>{d.value.splice(t,1)},$=async()=>{console.log("修改后的表结构:",d.value),k("update:loading",!0),await te(g.value,d.value),await _(g.value),NvaMessage.success("保存成功"),k("update:loading",!1)},y=t=>{t._key=Date.now()+Math.random()},i=()=>{const t=document.querySelector("#table-container"),a=document.querySelector("#table-wrapper");console.log("xxxxxxxxxxxxxxxx",t.clientHeight),a.style.height=t.clientHeight+"px"},s=b(null);return O(()=>{new MutationObserver(a=>{console.log("监听tableContainer内容变化"),i()}).observe(s.value,{childList:!0,subtree:!0,characterData:!0})}),U(()=>u.tableName,t=>{_(t)},{immediate:!0}),(t,a)=>{const c=T("NvaButton"),h=T("a-button");return n(),v("div",se,[e("div",oe,[C(c,{onClick:$,class:"mb-2"},{default:S(()=>a[0]||(a[0]=[B("SAVE")])),_:1})]),e("div",ne,[e("div",{id:"table-container",class:"table-container",ref_key:"tableContainer",ref:s},[e("table",re,[a[3]||(a[3]=e("thead",null,[e("tr",{class:"bg-gray-100"},[e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 字段名"),e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 类型"),e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 是否可空"),e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 默认值"),e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 操作")])],-1)),e("tbody",null,[(n(!0),v(V,null,M(d.value,(p,o)=>(n(),v("tr",{key:p._key,class:"hover:bg-gray-50"},[e("td",ue,[L(e("input",{"onUpdate:modelValue":l=>p.name=l,class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:l=>y(p)},null,40,de),[[E,p.name,void 0,{lazy:!0}]])]),e("td",ie,[L(e("select",{"onUpdate:modelValue":l=>p.type=l,class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:l=>y(p)},[(n(),v(V,null,M(r,l=>e("option",{key:l,value:l},z(l),9,pe)),64))],40,ce),[[H,p.type]])]),e("td",ve,[L(e("select",{"onUpdate:modelValue":l=>p.notnull=l,class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:l=>y(p)},a[1]||(a[1]=[e("option",{value:1},"是",-1),e("option",{value:0},"否",-1)]),40,be),[[H,p.notnull]])]),e("td",xe,[L(e("input",{"onUpdate:modelValue":l=>p.dflt_value=l,placeholder:"NULL",class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:l=>y(p)},null,40,ge),[[E,p.dflt_value,void 0,{lazy:!0}]])]),e("td",me,[e("div",fe,[e("button",{onClick:l=>w(o),class:"text-blue-600 hover:text-blue-800 mr-1 text-xs"},"前增",8,_e),e("button",{onClick:l=>m(o),class:"text-blue-600 hover:text-blue-800 mr-1 text-xs"},"后增",8,ye),e("button",{onClick:l=>N(o),class:"text-red-600 hover:text-red-800 text-xs"},"删除",8,he)]),e("div",we,[C(h,{size:"mini",type:"text"},{default:S(()=>a[2]||(a[2]=[B("操作")])),_:1})])])]))),128))])])],512)])])}}},ke=A(Ce,[["__scopeId","data-v-5cd91611"]]),Ne={class:"table-wrapper",id:"table-wrapper"},$e={class:"w-full border-collapse"},Te=["onMousedown"],Se=["onDblclick"],Ue={key:0},Le=["onUpdate:modelValue","onBlur","onKeyup"],Ve={__name:"Datas",props:{columns:{type:Array,required:!0,default:()=>[]},list:{type:Array,required:!0,default:()=>[]}},emits:["update:list"],setup(x,{emit:f}){const u=x,k=f,g=b(null),d=b(null),r=b([]),_=b(null),w=(i,s)=>g.value===i&&d.value===s,m=(i,s)=>{g.value=i,d.value=s},N=(i,s)=>{const t=u.list[i],a=r.value.findIndex(c=>c.id===t.id);a!==-1?r.value[a]={...r.value[a],[s]:t[s]}:r.value.push({id:t.id,[s]:t[s]}),console.log(r.value),k("update:list",r.value),g.value=null,d.value=null},$=(i,s)=>{const t=i.target.closest("th"),a=i.pageX,c=t.offsetWidth,h=o=>{console.log(t);const l=c+o.pageX-a;t.style.width=`${l}px`},p=()=>{document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",p)};document.addEventListener("mousemove",h),document.addEventListener("mouseup",p)},y=()=>{const i=document.querySelector("#table-container"),s=document.querySelector("#table-wrapper");s.style.height=i.clientHeight+"px"};return U(u.list,()=>{W(()=>{y()})}),O(()=>{new MutationObserver(s=>{y()}).observe(_.value,{childList:!0,subtree:!0,characterData:!0})}),X(()=>{}),(i,s)=>(n(),v("div",Ne,[e("div",{id:"table-container",class:"table-container",ref_key:"tableContainer",ref:_},[e("table",$e,[e("thead",null,[e("tr",null,[(n(!0),v(V,null,M(x.columns,t=>(n(),v("th",{key:t,class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"},[B(z(t)+" ",1),e("div",{class:"resize-handle",onMousedown:a=>$(a)},null,40,Te)]))),128))])]),e("tbody",null,[(n(!0),v(V,null,M(x.list,(t,a)=>(n(),v("tr",{key:a},[(n(!0),v(V,null,M(x.columns,c=>(n(),v("td",{key:`${a}-${c}`,class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate",onDblclick:h=>m(a,c)},[w(a,c)?L((n(),v("input",{key:1,"onUpdate:modelValue":h=>t[c]=h,onBlur:h=>N(a,c),onKeyup:K(h=>N(a,c),["enter"]),class:"w-full px-1 py-0.5 text-xs border-none focus:outline-none focus:ring-1 focus:ring-blue-500",ref_for:!0,ref:h=>{h&&h.focus()}},null,40,Le)),[[E,t[c]]]):(n(),v("span",Ue,z(t[c]),1))],40,Se))),128))]))),128))])])],512)]))}},Me=A(Ve,[["__scopeId","data-v-3c5188da"]]),Be={class:"w-full"},De={class:"mb-4"},Ee=["default-value"],ze={class:"mt-2 flex justify-end"},qe={class:"flex flex-row justify-between mb-2"},Ae={__name:"TableDatas",props:{tableName:{type:String,required:!0},loading:{type:Boolean,default:!1}},emits:["update:loading"],setup(x,{emit:f}){const u=x,k=f,g=b([]),d=b(!1),r=b(20),_=b(""),w=b([]),m=J(ae,{tableName:u.tableName}),{list:N,loading:$,refresh:y,result:i,page:s}=m;U(i,o=>{_.value=o.sql});const t=b(1),a=()=>{y({page:1,pageSize:r.value,tableName:u.tableName})},c=async()=>{$.value=!0;try{console.log(N.value),await le(u.tableName,{data:w.value}),y(),w.value=[],d.value=!1,NvaMessage.success("保存成功")}catch(o){console.error("Error saving changes:",o),NvaMessage.error("保存失败")}finally{$.value=!1}},h=o=>{w.value=o,console.log("newList",o)},p=async()=>{console.log("sqlStr",_.value),await y({page:1,pageSize:r.value,tableName:u.tableName,sql:_.value}),NvaMessage.success("查询成功")};return U(()=>u.tableName,o=>{console.log("newTableName",{tableName:o,page:1,pageSize:r.value}),y({tableName:o,page:1,pageSize:r.value})}),U(N,o=>{o.length>0&&(g.value=Object.keys(o[0]).filter(l=>l!=="_id"),console.log("columns",g.value))},{immediate:!0}),U(()=>s,o=>{t.value=o}),U($,o=>{k("update:loading",o)}),(o,l)=>{const j=T("NvaButton"),G=T("NvaPagination");return n(),v("div",Be,[e("div",De,[L(e("textarea",{"onUpdate:modelValue":l[0]||(l[0]=I=>_.value=I),"default-value":_.value,placeholder:"输入 SQL 查询...",class:"w-full h-24 p-2 border border-gray-300 rounded-md text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,8,Ee),[[E,_.value]]),e("div",ze,[C(j,{onClick:p},{default:S(()=>l[2]||(l[2]=[B("运行")])),_:1})])]),e("div",qe,[e("div",null,[l[4]||(l[4]=e("span",{class:"mr-2"},"每页显示:",-1)),L(e("select",{"onUpdate:modelValue":l[1]||(l[1]=I=>r.value=I),onChange:a,class:"border border-gray-300 px-2 py-1 text-sm"},l[3]||(l[3]=[e("option",{value:10},"10",-1),e("option",{value:20},"20",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),544),[[H,r.value]])]),C(j,{onClick:c,disabled:!w.value.length},{default:S(()=>l[5]||(l[5]=[B("保存更改")])),_:1},8,["disabled"])]),C(Me,{columns:g.value,list:q(N),"onUpdate:list":h},null,8,["columns","list"]),C(G,{hook:q(m)},null,8,["hook"])])}}},Ie=A(Ae,[["__scopeId","data-v-c04f2bd2"]]),Re={class:"flex flex-col lg:flex-row box-wrapper"},He=["onClick"],Oe={class:"flex-grow truncate"},je={class:"flex flex-row items-center hover:bg-gray-100 p-2 rounded-md cursor-pointer active:bg-gray-200"},Pe={__name:"Console",setup(x){const f=b([]),u=b(null),k=b(!0),g=b(!1),d=b(0),r=async()=>{k.value=!0;const w=await Z();f.value=w.data.data,k.value=!1},_=async w=>{u.value=w};return O(()=>{r()}),(w,m)=>{const N=T("a-spin"),$=T("BoxView"),y=T("NavTab"),i=T("a-empty");return n(),v("div",Re,[C($,{class:"w-full lg:w-1/5 lg:mr-4"},{default:S(()=>[C(N,{loading:k.value,class:"w-full h-full"},{default:S(()=>[(n(!0),v(V,null,M(f.value,(s,t)=>(n(),v("div",{onClick:a=>_(s.name),class:Q(["flex flex-row items-center hover:bg-gray-100 p-2 rounded-md cursor-pointer active:bg-gray-200",u.value==s.name&&"bg-gray-200"]),key:t},[C(q(Y),{size:"24",class:"mr-2 flex-shrink-0"}),e("span",Oe,z(s.name),1)],10,He))),128)),e("div",je,[C(q(F),{size:"24",class:"mr-2 flex-shrink-0"}),m[3]||(m[3]=e("span",{class:"flex-grow truncate"},"新建表",-1))])]),_:1},8,["loading"])]),_:1}),C($,{class:"boxRight"},{default:S(()=>[C(N,{loading:g.value,class:"w-full h-full"},{default:S(()=>[u.value?(n(),v(V,{key:0},[C(y,{tabs:["表结构","数据"],tabIndex:d.value,"onUpdate:tabIndex":m[0]||(m[0]=s=>d.value=s)},null,8,["tabIndex"]),d.value==0?(n(),R(ke,{key:0,tableName:u.value,loading:g.value,"onUpdate:loading":m[1]||(m[1]=s=>g.value=s)},null,8,["tableName","loading"])):P("",!0),d.value==1?(n(),R(Ie,{key:1,tableName:u.value,loading:g.value,"onUpdate:loading":m[2]||(m[2]=s=>g.value=s)},null,8,["tableName","loading"])):P("",!0)],64)):(n(),R(i,{key:1,class:"w-full h-full flex items-center justify-center"}))]),_:1},8,["loading"])]),_:1})])}}},Fe=A(Pe,[["__scopeId","data-v-6f6f0a18"]]);export{Fe as default};
