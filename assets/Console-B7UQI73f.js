import{a as P,m as X,g as W,u as K,b as F,d as Q}from"./db-DQ5vIj5x.js";import{k as I,r as c,f as H,D as U,h as k,o as u,a as m,e,j as f,w as T,q as D,F as V,s as L,z as M,E as B,X as R,t as z,v as Y,Y as Z,m as E,Z as J,u as q,U as ee,G as j,n as te}from"./index-BekGhLC_.js";import{u as ae}from"./useList-CIe6ndib.js";import{I as le}from"./index-BThhGf2B.js";const oe={class:"overflow-x-auto"},se={class:"flex flex-row justify-end"},ne={class:"table-wrapper",id:"table-wrapper"},re={class:"w-full border border-gray-300 text-sm"},ue={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},de=["onUpdate:modelValue","onChange"],ie={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},ce=["onUpdate:modelValue","onChange"],pe=["value"],ve={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},xe=["onUpdate:modelValue","onChange"],be={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},me=["onUpdate:modelValue","onChange"],ge={class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate"},fe={class:"hidden lg:block"},_e=["onClick"],ye=["onClick"],he=["onClick"],we={class:"lg:hidden"},Ce={__name:"TableStruct",props:{tableName:{type:String,default:""},loading:{type:Boolean,default:!1}},emits:["update:tableName","update:loading"],setup($,{emit:S}){const g=$,_=S,x=c(null),v=c(null),d=["INTEGER","REAL","TEXT","BLOB","NULL","VARCHAR","CHAR","BOOLEAN","DATE","DATETIME"],y=async o=>{if(o){x.value=o,_("update:loading",!0);const l=await P(o);v.value=l.data.data.map(i=>({...i,_key:Date.now()+Math.random()})),_("update:loading",!1)}},h=o=>{const l={name:"",type:d[0],notnull:0,dflt_value:"",_key:Date.now()+Math.random()};v.value.splice(o,0,l)},C=o=>{const l={name:"",type:d[0],notnull:0,dflt_value:"",_key:Date.now()+Math.random()};v.value.splice(o+1,0,l)},N=o=>{v.value.splice(o,1)},w=async()=>{console.log("修改后的表结构:",v.value),_("update:loading",!0),await X(x.value,v.value),await y(x.value),NvaMessage.success("保存成功"),_("update:loading",!1)},s=o=>{o._key=Date.now()+Math.random()},p=()=>{const o=document.querySelector("#table-container"),l=document.querySelector("#table-wrapper");console.log("xxxxxxxxxxxxxxxx",o.clientHeight),l.style.height=o.clientHeight+"px"},r=c(null);return H(()=>{new MutationObserver(l=>{console.log("监听tableContainer内容变化"),p()}).observe(r.value,{childList:!0,subtree:!0,characterData:!0})}),U(()=>g.tableName,o=>{y(o)},{immediate:!0}),(o,l)=>{const i=k("NvaButton"),b=k("a-button");return u(),m("div",oe,[e("div",se,[f(i,{onClick:w,class:"mb-2"},{default:T(()=>l[0]||(l[0]=[D("SAVE")])),_:1})]),e("div",ne,[e("div",{id:"table-container",class:"table-container",ref_key:"tableContainer",ref:r},[e("table",re,[l[3]||(l[3]=e("thead",null,[e("tr",{class:"bg-gray-100"},[e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 字段名"),e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 类型"),e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 不许为空"),e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 默认值"),e("th",{class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"}," 操作")])],-1)),e("tbody",null,[(u(!0),m(V,null,L(v.value,(t,n)=>(u(),m("tr",{key:t._key,class:"hover:bg-gray-50"},[e("td",ue,[M(e("input",{"onUpdate:modelValue":a=>t.name=a,class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:a=>s(t)},null,40,de),[[B,t.name,void 0,{lazy:!0}]])]),e("td",ie,[M(e("select",{"onUpdate:modelValue":a=>t.type=a,class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:a=>s(t)},[(u(),m(V,null,L(d,a=>e("option",{key:a,value:a},z(a),9,pe)),64))],40,ce),[[R,t.type]])]),e("td",ve,[M(e("select",{"onUpdate:modelValue":a=>t.notnull=a,class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:a=>s(t)},l[1]||(l[1]=[e("option",{value:1},"是",-1),e("option",{value:0},"否",-1)]),40,xe),[[R,t.notnull]])]),e("td",be,[M(e("input",{"onUpdate:modelValue":a=>t.dflt_value=a,placeholder:"NULL",class:"border border-gray-300 w-full px-1 py-0.5 text-xs",onChange:a=>s(t)},null,40,me),[[B,t.dflt_value,void 0,{lazy:!0}]])]),e("td",ge,[e("div",fe,[e("button",{onClick:a=>h(n),class:"text-blue-600 hover:text-blue-800 mr-1 text-xs"},"前增",8,_e),e("button",{onClick:a=>C(n),class:"text-blue-600 hover:text-blue-800 mr-1 text-xs"},"后增",8,ye),e("button",{onClick:a=>N(n),class:"text-red-600 hover:text-red-800 text-xs"},"删除",8,he)]),e("div",we,[f(b,{size:"mini",type:"text"},{default:T(()=>l[2]||(l[2]=[D("操作")])),_:1})])])]))),128))])])],512)])])}}},ke=I(Ce,[["__scopeId","data-v-1968e7a8"]]),Ne={class:"table-wrapper",id:"table-wrapper"},Te={class:"w-full border-collapse"},$e=["onMousedown"],Se=["onDblclick"],Ve=["onUpdate:modelValue","onBlur","onKeyup"],Ue={__name:"Datas",props:{columns:{type:Array,required:!0,default:()=>[]},list:{type:Array,required:!0,default:()=>[]}},emits:["update:list"],setup($,{emit:S}){const g=$,_=S,x=c(null),v=c(null),d=c([]),y=c(null),h=(p,r)=>x.value===p&&v.value===r,C=(p,r)=>{x.value=p,v.value=r},N=(p,r)=>{const o=g.list[p],l=d.value.findIndex(i=>i.id===o.id);l!==-1?d.value[l]={...d.value[l],[r]:o[r]}:d.value.push({id:o.id,[r]:o[r]}),console.log(d.value),_("update:list",d.value),x.value=null,v.value=null},w=(p,r)=>{const o=p.target.closest("th"),l=p.pageX,i=o.offsetWidth,b=n=>{console.log(o);const a=i+n.pageX-l;o.style.width=`${a}px`},t=()=>{document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",t)};document.addEventListener("mousemove",b),document.addEventListener("mouseup",t)},s=()=>{const p=document.querySelector("#table-container"),r=document.querySelector("#table-wrapper");r.style.height=p.clientHeight+"px"};return U(g.list,()=>{Y(()=>{s()})}),H(()=>{new MutationObserver(r=>{s()}).observe(y.value,{childList:!0,subtree:!0,characterData:!0})}),Z(()=>{}),(p,r)=>{const o=k("NvaTextScroll");return u(),m("div",Ne,[e("div",{id:"table-container",class:"table-container",ref_key:"tableContainer",ref:y},[e("table",Te,[e("thead",null,[e("tr",null,[(u(!0),m(V,null,L($.columns,l=>(u(),m("th",{key:l,class:"border border-gray-300 px-1 py-0.5 text-xs font-normal text-left max-w-[200px] truncate relative"},[D(z(l)+" ",1),e("div",{class:"resize-handle",onMousedown:i=>w(i)},null,40,$e)]))),128))])]),e("tbody",null,[(u(!0),m(V,null,L($.list,(l,i)=>(u(),m("tr",{key:i},[(u(!0),m(V,null,L($.columns,b=>(u(),m("td",{key:`${i}-${b}`,class:"border border-gray-300 px-1 py-0.5 text-xs max-w-[200px] truncate",onDblclick:t=>C(i,b)},[h(i,b)?M((u(),m("input",{key:1,"onUpdate:modelValue":t=>l[b]=t,onBlur:t=>N(i,b),onKeyup:J(t=>N(i,b),["enter"]),class:"w-full px-1 py-0.5 text-xs border-none focus:outline-none focus:ring-1 focus:ring-blue-500",ref_for:!0,ref:t=>{t&&t.focus()}},null,40,Ve)),[[B,l[b]]]):(u(),E(o,{key:`text_${l.id}`,start:"hover"},{default:T(()=>[D(z(l[b]),1)]),_:2},1024))],40,Se))),128))]))),128))])])],512)])}}},Me=I(Ue,[["__scopeId","data-v-871d2873"]]),Le={class:"w-full"},De={class:"mb-4"},Ee=["default-value"],Be={class:"mt-2 flex justify-end"},ze={class:"flex flex-row justify-between mb-2"},qe={__name:"TableDatas",props:{tableName:{type:String,required:!0},loading:{type:Boolean,default:!1}},emits:["update:loading"],setup($,{emit:S}){const g=$,_=S,x=c([]),v=c(!1),d=c(20),y=c(""),h=c([]),C=ae(W,{tableName:g.tableName}),{list:N,loading:w,refresh:s,result:p,page:r}=C;U(p,n=>{y.value=n.sql});const o=c(1),l=()=>{s({page:1,pageSize:d.value,tableName:g.tableName},!0)},i=async()=>{w.value=!0;try{console.log(N.value),await K(g.tableName,{data:h.value}),s(),h.value=[],v.value=!1,NvaMessage.success("保存成功")}catch(n){console.error("Error saving changes:",n),NvaMessage.error("保存失败")}finally{w.value=!1}},b=n=>{h.value=n,console.log("newList",n)},t=async()=>{console.log("sqlStr",y.value),await s({page:1,pageSize:d.value,tableName:g.tableName,sql:y.value},!0),NvaMessage.success("查询成功")};return U(()=>g.tableName,n=>{console.log("newTableName",{tableName:n,page:1,pageSize:d.value}),s({tableName:n,page:1,pageSize:d.value},!0)}),U(N,n=>{n.length>0&&(x.value=Object.keys(n[0]).filter(a=>a!=="_id"),console.log("columns",x.value))},{immediate:!0}),U(()=>r,n=>{o.value=n}),U(w,n=>{_("update:loading",n)}),(n,a)=>{const O=k("NvaButton"),G=k("NvaPagination");return u(),m("div",Le,[e("div",De,[M(e("textarea",{"onUpdate:modelValue":a[0]||(a[0]=A=>y.value=A),"default-value":y.value,placeholder:"输入 SQL 查询...",class:"w-full h-24 p-2 border border-gray-300 rounded-md text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,8,Ee),[[B,y.value]]),e("div",Be,[f(O,{onClick:t},{default:T(()=>a[2]||(a[2]=[D("运行")])),_:1})])]),e("div",ze,[e("div",null,[a[4]||(a[4]=e("span",{class:"mr-2"},"每页显示:",-1)),M(e("select",{"onUpdate:modelValue":a[1]||(a[1]=A=>d.value=A),onChange:l,class:"border border-gray-300 px-2 py-1 text-sm"},a[3]||(a[3]=[e("option",{value:10},"10",-1),e("option",{value:20},"20",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),544),[[R,d.value]])]),f(O,{onClick:i,disabled:!h.value.length},{default:T(()=>a[5]||(a[5]=[D("保存更改")])),_:1},8,["disabled"])]),f(Me,{columns:x.value,list:q(N),"onUpdate:list":b},null,8,["columns","list"]),f(G,{hook:q(C)},null,8,["hook"])])}}},Ie=I(qe,[["__scopeId","data-v-f0cb6544"]]),Ae={class:"flex flex-col lg:flex-row box-wrapper"},Re=["onClick"],He={class:"flex-grow truncate"},Oe={__name:"Console",setup($){const S=c([]),g=c(null),_=c(!0),x=c(!1),v=c(0),d=async()=>{_.value=!0;const w=await F();S.value=w.data.data,_.value=!1},y=async w=>{g.value=w};H(()=>{d()});const h=c(!1),C=c(""),N=async()=>{if(!C.value)return NvaMessage.error("请输入表名");_.value=!0,await Q(C.value),await d(),_.value=!1};return(w,s)=>{const p=k("a-spin"),r=k("BoxView"),o=k("NvaTab"),l=k("a-empty"),i=k("NvaInput"),b=k("NvaModal");return u(),m(V,null,[e("div",Ae,[f(r,{class:"w-full lg:w-1/5 lg:mr-4"},{default:T(()=>[f(p,{loading:_.value,class:"w-full h-full"},{default:T(()=>[(u(!0),m(V,null,L(S.value,(t,n)=>(u(),m("div",{onClick:a=>y(t.name),class:te(["flex flex-row items-center hover:bg-gray-100 p-2 rounded-md cursor-pointer active:bg-gray-200",g.value==t.name&&"bg-gray-200"]),key:n},[f(q(le),{size:"24",class:"mr-2 flex-shrink-0"}),e("span",He,z(t.name),1)],10,Re))),128)),e("div",{onClick:s[0]||(s[0]=t=>h.value=!0),class:"flex flex-row items-center hover:bg-gray-100 p-2 rounded-md cursor-pointer active:bg-gray-200"},[f(q(ee),{size:"24",class:"mr-2 flex-shrink-0"}),s[6]||(s[6]=e("span",{class:"flex-grow truncate"},"新建表",-1))])]),_:1},8,["loading"])]),_:1}),f(r,{class:"boxRight"},{default:T(()=>[f(p,{loading:x.value,class:"w-full h-full"},{default:T(()=>[g.value?(u(),m(V,{key:0},[f(o,{tabs:["表结构","数据"],tabIndex:v.value,"onUpdate:tabIndex":s[1]||(s[1]=t=>v.value=t)},null,8,["tabIndex"]),v.value==0?(u(),E(ke,{key:0,tableName:g.value,loading:x.value,"onUpdate:loading":s[2]||(s[2]=t=>x.value=t)},null,8,["tableName","loading"])):j("",!0),v.value==1?(u(),E(Ie,{key:1,tableName:g.value,loading:x.value,"onUpdate:loading":s[3]||(s[3]=t=>x.value=t)},null,8,["tableName","loading"])):j("",!0)],64)):(u(),E(l,{key:1,class:"w-full h-full flex items-center justify-center"}))]),_:1},8,["loading"])]),_:1})]),f(b,{modelValue:h.value,"onUpdate:modelValue":s[5]||(s[5]=t=>h.value=t),title:"新建表",onOk:N},{default:T(()=>[f(i,{modelValue:C.value,"onUpdate:modelValue":s[4]||(s[4]=t=>C.value=t),placeholder:"请输入表名"},null,8,["modelValue"])]),_:1},8,["modelValue"])],64)}}},We=I(Oe,[["__scopeId","data-v-18652776"]]);export{We as default};
