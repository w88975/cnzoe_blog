import{b as N,c as T}from"./91porn-DBJzLBgJ.js";import{s as I,O as $,u as k}from"./config-CAwTAHme.js";import{B}from"./BoxView-BVPahz9Q.js";import{r as m,c as R,f as S,q as U,w as p,x as D,o as g,j as _,v as L,t as v,e as o,a as h,h as f}from"./index-cn3SwOI5.js";import"./index-BY53CZTv.js";const C={class:"mb-4 text-sm text-gray-600"},P={class:"mb-1"},V={class:"text-blue-600"},j={class:"mb-1"},z={class:"text-green-600"},M={class:"text-red-600"},q={class:"article-content"},E=["innerHTML"],F={key:1},W={__name:"91PornDetail",setup(H){const w=D(),i=m(null),e=m({authorName:"",authorUID:"",title:"",postTime:"",content:"",images:[],saved_imgs:""}),d=m(!1),c=m(0),b=R(()=>{var s;return((s=e.value.images)==null?void 0:s.length)||0});S(async()=>{i.value=w.query.tid;const s=await N(i.value);if(e.value=s.data,e.value.images&&e.value.images.length>0&&e.value.saved_imgs){const t=e.value.images,l=e.value.saved_imgs.split(",");if(t.length===l.length)for(let a=0;a<t.length;a++){const n=t[a],r=l[a];e.value.content&&(e.value.content=e.value.content.replace(new RegExp(n,"g"),r))}else console.warn("The number of old images does not match the number of saved images.")}});const y=async()=>{if(e.value.images&&e.value.images.length>0){const s="/porn91";try{d.value=!0,c.value=0;const t=[];for(const[l,a]of e.value.images.entries()){const n=`https://91porn.lwhzak.workers.dev/${a}`,r=`${e.value.authorName}_${i.value}_`,u=await x(n,s,r);await I({url:u.url,fileSize:u.fileSize,dir:s,originalUrl:n,title:e.value.title,authorName:e.value.authorName,postTime:e.value.postTime,tid:i.value}),t.push($+u.url),c.value=l+1}await T(i.value,t.join(",")),alert("文档保存成功！")}catch(t){console.error("保存文档时出错：",t),alert("保存文档失败，请稍后重试。")}finally{d.value=!1,c.value=0}}else alert("没有图片需要保存。")};async function x(s,t,l){try{const n=await(await fetch(s)).blob(),r=l+(s.split("/").pop()||`image_${Date.now()}.jpg`),u=new File([n],r,{type:n.type});return await k(u,()=>{},t)}catch(a){throw console.error("下载或上传图片时出错：",a),a}}return(s,t)=>{const l=f("NvaButton"),a=f("a-space"),n=f("TitleLine");return g(),U(B,null,{default:p(()=>[_(n,{title:e.value.title||"加载中..."},{right:p(()=>[_(a,null,{default:p(()=>[_(l,{type:"primary",onClick:y},{default:p(()=>[L(v(d.value?`保存中 (${c.value}/${b.value})`:"保存文档"),1)]),_:1})]),_:1})]),_:1},8,["title"]),o("div",C,[o("p",P,[t[0]||(t[0]=o("span",{class:"font-semibold"},"作者：",-1)),o("span",V,v(e.value.authorName),1)]),o("p",j,[t[1]||(t[1]=o("span",{class:"font-semibold"},"发帖时间：",-1)),o("span",z,v(e.value.postTime),1)]),o("p",null,[t[2]||(t[2]=o("span",{class:"font-semibold"},"图片数量：",-1)),o("span",M,v(e.value.images.length),1)])]),o("div",q,[e.value.content?(g(),h("div",{key:0,innerHTML:e.value.content},null,8,E)):(g(),h("p",F,"加载中..."))])]),_:1})}}};export{W as default};
